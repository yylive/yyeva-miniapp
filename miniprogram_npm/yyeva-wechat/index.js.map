{"version":3,"sources":["../src/player/animator.ts","../src/player/loopCheck.ts","../src/player/naPlayer.ts","../src/player/video.ts","../src/player/utils.ts","../src/player/effectKey.ts","../src/player/webgl.ts","../src/parser/zlib/const.ts","../src/parser/zlib/huffman.ts","../src/parser/zlib/utils/BitReadStream.ts","../src/parser/zlib/utils/Uint8WriteStream.ts","../src/parser/zlib/inflate.ts","../src/parser/zlib/zlib.ts","../src/parser/jwt.ts","../src/utils/md5.ts","../src/utils/fileUtils.ts","../src/parser/cacheManager.ts","../src/parser/index.ts","../src/player/index.ts","../src/config.ts","../src/index.ts"],"sourcesContent":["import {PlayerOptionsType} from './types'\r\nclass Animator {\r\n  private frameDelay: number\r\n  private frameStartTime: number\r\n  private currentTime: number\r\n  private op!: PlayerOptionsType\r\n  private animateId: any\r\n  public fps: number\r\n  public frame: number\r\n  public requestAnim: (...args: any[]) => void\r\n  public cancelAnim: (...args: any[]) => void\r\n  public onUpdate?: () => void\r\n  constructor(op: PlayerOptionsType) {\r\n    this.requestAnim = this.returnRequestAnim()\r\n    this.cancelAnim = this.returnCancelAnim()\r\n    this.op = op\r\n    this.frameStartTime = 0\r\n    this.frameDelay = 0\r\n    this.currentTime = 0\r\n    this.fps = 0\r\n    this.frame = 0\r\n  }\r\n  init({fps}: {fps: number}) {\r\n    this.fps = fps || 20\r\n    // this.fps = fps < 20 ? fps : 20\r\n    this.frameDelay = 1000 / this.fps\r\n    // wx.setPreferredFramesPerSecond(fps || 30)\r\n  }\r\n  currentTimeMillsecond() {\r\n    return new Date().getTime()\r\n  }\r\n  start() {\r\n    if (this.frameDelay === 0 && this.fps > 0) this.frameDelay = 1000 / this.fps\r\n    console.debug('animator start', this.animateId, this.frameDelay, this.fps)\r\n    this.frameStartTime = this.currentTimeMillsecond()\r\n    this.cancelAnim()\r\n    this.requestAnim(this.drawFrame)\r\n  }\r\n  stop() {\r\n    console.debug('animator stop', this.animateId)\r\n    //\r\n    this.frame = 0\r\n    this.currentTime = 0\r\n    //\r\n    this.cancelAnim()\r\n  }\r\n  reset() {\r\n    this.frame = 0\r\n    this.currentTime = 0\r\n  }\r\n  destroy() {\r\n    // console.log('[animator destroy]', this.animateId)\r\n    this.cancelAnim()\r\n    this.op = undefined as any\r\n    this.cancelAnim = undefined as any\r\n    this.requestAnim = undefined as any\r\n    this.onUpdate = undefined\r\n  }\r\n  setCurrentTime(t: number) {\r\n    this.currentTime = t\r\n  }\r\n  drawFrame() {\r\n    this.cancelAnim()\r\n    this.requestAnim(this.drawFrame)\r\n    const mediaTime = this.currentTime\r\n    this.frame = this.getCurrentFrame(mediaTime)\r\n    // this.frame = frame\r\n    // console.debug('drawFrame onUpdate', frame)\r\n    this.onUpdate && this.onUpdate()\r\n  }\r\n  getCurrentFrame(mediaTime = 0) {\r\n    // return Math.round(mediaTime * this.fps) + (this.op.offset || 0)\r\n    return Math.round(mediaTime * this.fps)\r\n  }\r\n  returnRequestAnim() {\r\n    return (fn: any) => {\r\n      return this.op.canvas.requestAnimationFrame(() => {\r\n        const now = this.currentTimeMillsecond()\r\n        const delta = now - this.frameStartTime\r\n        if (delta > this.frameDelay) {\r\n          this.frameStartTime = now - (delta % this.frameDelay)\r\n          return fn.call(this)\r\n        }\r\n        if (this.requestAnim) this.animateId = this.requestAnim(fn)\r\n      })\r\n    }\r\n  }\r\n  returnCancelAnim() {\r\n    return () => this.animateId && this.op.canvas.cancelAnimationFrame(this.animateId)\r\n  }\r\n}\r\n\r\nexport default Animator\r\n","import {EventCallback} from './types'\r\n\r\nexport class LoopChecker {\r\n  public loopCount = Infinity\r\n  private playedLoopCount = 0\r\n  public onLoop?: EventCallback\r\n\r\n  constructor(loop?: boolean | number, onLoop?: EventCallback) {\r\n    const type = typeof loop\r\n    if (type === 'boolean') {\r\n      this.loopCount = loop ? Infinity : 1\r\n    } else if (type === 'number') {\r\n      this.loopCount = Number(loop)\r\n    }\r\n\r\n    this.onLoop = onLoop\r\n    // console.debug('[LoopChecker] this._loopCount=', this.loopCount, ', loop=', loop)\r\n  }\r\n  destroy() {\r\n    this.onLoop = undefined\r\n  }\r\n\r\n  public addLoop() {\r\n    /* console.debug(\r\n      '[LoopChecker] addLoop.... this.playedLoopCount=',\r\n      this.playedLoopCount,\r\n      ', this.loopCount=',\r\n      this.loopCount,\r\n    ) */\r\n    if (this.playedLoopCount < this.loopCount) {\r\n      this.playedLoopCount = this.playedLoopCount + 1\r\n      this.onLoop && this.onLoop(this.playedLoopCount)\r\n    }\r\n\r\n    if (this.playedLoopCount == this.loopCount) {\r\n      // console.debug('[LoopChecker] finished.... this.playedLoopCount=', this.playedLoopCount)\r\n\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n}\r\n","import {PlayerOptionsType, VideoInfoType} from './types'\r\nimport {platform} from './utils'\r\nexport default class NaPlayer {\r\n  videoDecoder: WechatMiniprogram.VideoDecoder\r\n  mediaAudioPlayer!: WechatMiniprogram.MediaAudioPlayer\r\n  filePath: string\r\n  op: PlayerOptionsType\r\n  public onStart?: (d: VideoInfoType) => void\r\n  public onStop?: (d: any) => void\r\n  public onSeek?: (d: any) => void\r\n  public onBufferchange?: (d: any) => void\r\n  public onEnd?: (d: any) => void\r\n  constructor(op: PlayerOptionsType, filePath?: string) {\r\n    // console.log('[NaPlayer platform]', platform)\r\n    this.op = op\r\n    this.filePath = filePath || op.videoUrl\r\n    if (!this.op.mute) this.mediaAudioPlayer = wx.createMediaAudioPlayer()\r\n    this.videoDecoder = wx.createVideoDecoder()\r\n    //\r\n    wx.onMemoryWarning(this.onMemoryWarning)\r\n  }\r\n  setup() {\r\n    this.onStart && this.videoDecoder.on('start', this.onStart)\r\n    this.onStop && this.videoDecoder.on('stop', this.onStop)\r\n    this.onSeek && this.videoDecoder.on('seek', this.onSeek)\r\n    this.onBufferchange && this.videoDecoder.on('bufferchange', this.onBufferchange)\r\n    this.onEnd && this.videoDecoder.on('ended', this.onEnd)\r\n  }\r\n  seek(pos: number) {\r\n    console.debug('[videoDecoder] seek', pos)\r\n    // this.videoDecoder.seek(pos)\r\n  }\r\n  start() {\r\n    this.startVideoPlayer()\r\n    this.startAudioPlayer()\r\n  }\r\n  stop() {\r\n    this.stopAudioPlayer()\r\n    this.stopVideoPlayer()\r\n  }\r\n  //\r\n  startVideoPlayer() {\r\n    const o: WechatMiniprogram.VideoDecoderStartOption = {\r\n      source: this.filePath,\r\n      mode: 1,\r\n      // abortAudio: true,\r\n      // abortVideo: true,\r\n    }\r\n    console.debug('[videoDecoder] video start', o)\r\n    this.videoDecoder.start(o).then(e => {\r\n      console.debug('[videoDecoder] start resolve')\r\n    })\r\n  }\r\n  stopVideoPlayer() {\r\n    // this.videoDecoder.stop()\r\n    // 停止播放器\r\n    this.videoDecoder.stop()\r\n  }\r\n  //\r\n  startAudioPlayer() {\r\n    if (!this.op.mute) {\r\n      this.mediaAudioPlayer.start().then(() => {\r\n        // 添加播放器音频来源\r\n        this.mediaAudioPlayer.addAudioSource(this.videoDecoder).then(res => {\r\n          console.debug('[mediaAudioPlayer]')\r\n        })\r\n      })\r\n    }\r\n  }\r\n  stopAudioPlayer() {\r\n    if (!this.op.mute) {\r\n      this.mediaAudioPlayer.stop()\r\n      this.mediaAudioPlayer.removeAudioSource(this.videoDecoder)\r\n      // this.mediaAudioPlayer.destroy()\r\n    }\r\n  }\r\n  getFrameData() {\r\n    return this.videoDecoder.getFrameData()\r\n  }\r\n  destroy() {\r\n    if (!this.op.mute) {\r\n      this.mediaAudioPlayer.destroy()\r\n      this.mediaAudioPlayer = undefined\r\n    }\r\n    this.mediaAudioPlayer = undefined\r\n    //\r\n    this.onStart && this.videoDecoder.off('start', this.onStart)\r\n    this.onStop && this.videoDecoder.off('stop', this.onStop)\r\n    this.onSeek && this.videoDecoder.off('seek', this.onSeek)\r\n    this.onBufferchange && this.videoDecoder.off('bufferchange', this.onBufferchange)\r\n    this.onEnd && this.videoDecoder.off('ended', this.onEnd)\r\n    //\r\n    this.videoDecoder.remove()\r\n    this.videoDecoder = undefined\r\n    this.onStart = undefined\r\n    this.onStop = undefined\r\n    this.onSeek = undefined\r\n    this.onBufferchange = undefined\r\n    this.onEnd = undefined\r\n    this.op = undefined\r\n    //\r\n    wx.offMemoryWarning(this.onMemoryWarning)\r\n  }\r\n\r\n  private onMemoryWarning(d) {\r\n    console.warn('onMemoryWarning', d)\r\n  }\r\n  debug2D(f: WechatMiniprogram.FrameDataOptions) {\r\n    if (this.op.canvas2d) {\r\n      this.op.canvas2d.height = f.height\r\n      this.op.canvas2d.width = f.width\r\n      const imageData = this.op.canvas2d.createImageData(f.data, f.width, f.height)\r\n      this.op.ctx2d.clearRect(0, 0, f.width, f.height)\r\n      this.op.ctx2d.putImageData(imageData, 0, 0)\r\n    }\r\n  }\r\n}\r\n","import type {PlayerOptionsType, VideoInfoType} from './types'\r\nimport Animator from './animator'\r\nimport {LoopChecker} from './loopCheck'\r\nimport NaPlayer from './naPlayer'\r\nclass VideoPlayer {\r\n  op: PlayerOptionsType\r\n  info!: VideoInfoType\r\n  animator: Animator\r\n  player: NaPlayer\r\n  public isStart: boolean\r\n  public onUpdate?: (frame: number, d: WechatMiniprogram.FrameDataOptions) => void\r\n  public onInit?: (d: VideoInfoType) => void\r\n  public onEnd?: () => void\r\n  filePath: string\r\n  renderNullTime: number // 防止解码失败卡死\r\n  MaxNullTime: number //解码失败 次数 重新播放\r\n\r\n  private loopChecker!: LoopChecker\r\n\r\n  constructor(op: PlayerOptionsType, filePath?: string) {\r\n    this.op = op\r\n    this.animator = new Animator(op)\r\n    this.renderNullTime = 0\r\n    this.MaxNullTime = 50\r\n    this.loopChecker = new LoopChecker(op.loop, op.onLoop)\r\n    // Na Player setup\r\n    this.player = new NaPlayer(op, filePath)\r\n    this.player.onStart = (d: VideoInfoType) => {\r\n      console.debug('[onStart]', JSON.stringify(d))\r\n      this.info = d\r\n      this.playStart(d)\r\n      this.op.onStart && this.op.onStart(d)\r\n    }\r\n    this.player.onStop = e => {\r\n      console.debug('[onStop]', e)\r\n      this.animator.stop()\r\n      this.op.onStop && this.op.onStop(e)\r\n    }\r\n    this.player.onSeek = e => {\r\n      console.debug('[onSeek]', e.position)\r\n    }\r\n    this.player.onBufferchange = e => {\r\n      // console.debug(`[onBufferchange] frame ${this.animator.frame}`)\r\n    }\r\n    this.player.onEnd = async e => {\r\n      console.debug('[ended]', e)\r\n      await this.playEnd()\r\n    }\r\n    this.player.setup()\r\n    //\r\n    this.animator.onUpdate = () => {\r\n      this.render()\r\n    }\r\n  }\r\n  playStart(d: VideoInfoType) {\r\n    this.onInit && this.onInit(d)\r\n    this.animator.init({fps: this.op.fps || d.fps})\r\n    this.animator.start()\r\n  }\r\n  async playEnd() {\r\n    this.stop()\r\n    this.animator.stop()\r\n    console.debug(`this.op.loop`, this.op.loop)\r\n\r\n    if (this.loopChecker.addLoop()) {\r\n      this.start()\r\n    } else {\r\n      console.debug('[video onEnd]', this.op.videoUrl)\r\n      this.onEnd && this.onEnd()\r\n      this.op.onEnd && this.op.onEnd()\r\n    }\r\n  }\r\n  render() {\r\n    const f = this.player.getFrameData()\r\n    if (!f) {\r\n      this.renderNullTime++\r\n      if (this.animator.frame > 0 && this.renderNullTime >= this.MaxNullTime) {\r\n        this.playEnd()\r\n        this.renderNullTime = 0\r\n      }\r\n      return\r\n    }\r\n    this.renderNullTime = 0\r\n    this.animator.setCurrentTime(f.pkDts / 1000)\r\n    this.onUpdate && this.onUpdate(this.animator.frame, f)\r\n    // arraybuffer debug 代码\r\n    this.player.debug2D(f)\r\n  }\r\n  start() {\r\n    this.isStart = true\r\n    this.player.start()\r\n    //\r\n  }\r\n  stop() {\r\n    this.isStart = false\r\n    this.player.stop()\r\n  }\r\n  seek(pos: number) {\r\n    this.player.seek(pos)\r\n  }\r\n  destroy() {\r\n    // console.log('[video destroy]')\r\n    if (this.isStart) {\r\n      this.stop()\r\n    }\r\n    this.animator.destroy()\r\n    this.player.destroy()\r\n    this.loopChecker.destroy()\r\n    this.player = undefined\r\n    this.info = undefined\r\n    this.animator = undefined\r\n    this.renderNullTime = 0\r\n    this.MaxNullTime = 0\r\n    this.loopChecker = undefined\r\n    this.onUpdate = undefined\r\n    this.onInit = undefined\r\n    this.onEnd = undefined\r\n    this.render = undefined\r\n  }\r\n}\r\nexport default VideoPlayer\r\n","export const systemInfo = wx.getSystemInfoSync()\r\nexport const dpr = systemInfo.pixelRatio\r\nexport const pixelRatio = systemInfo.pixelRatio\r\nexport const platform = systemInfo.platform\r\n","import {VideoAnimateEffectType, EScaleMode, PlayerOptionsType} from './types'\r\n\r\nexport default class EffectKey {\r\n  canvas: WechatMiniprogram.OffscreenCanvas\r\n  ctx: any\r\n  op: PlayerOptionsType\r\n  constructor(op: PlayerOptionsType) {\r\n    this.op = op\r\n    this.canvas = wx.createOffscreenCanvas({type: '2d', width: 300, height: 300})\r\n    if (this.canvas) {\r\n      this.ctx = this.canvas.getContext('2d')\r\n    }\r\n  }\r\n  destroy() {\r\n    this.op = undefined\r\n    this.canvas = undefined\r\n    this.ctx = undefined\r\n  }\r\n  parseFromSrcAndOptions(effect?: VideoAnimateEffectType[]) {\r\n    if (!effect) return\r\n    const effects = this.op.effects || {}\r\n    return Promise.all(\r\n      effect.map(async item => {\r\n        //\r\n        const effectType = item.effectType\r\n        const effectTag = item.effectTag\r\n        // text\r\n        if (effectType === 'txt') {\r\n          item.text = effects[effectTag]\r\n          item.img = await this.makeTextImg(item)\r\n        } // image\r\n        else if (effectType === 'img') {\r\n          item.img = await this.makeImage(item, effects[effectTag])\r\n        }\r\n        // console.log(`item.img`, item.img, item.text, effectType, effectTag)\r\n      }),\r\n    )\r\n  }\r\n\r\n  _getText(ctx: any, text: string, maxWidth: number): string {\r\n    console.debug('_getText text=', text, maxWidth, this.op?.font?.overflow)\r\n    if (!this.op?.font?.overflow || this.op.font.overflow === 'cut') {\r\n      const textWidth = ctx.measureText(text).width\r\n      if (maxWidth == undefined) {\r\n        maxWidth = textWidth\r\n      } else if (textWidth > maxWidth) {\r\n        let len = text.length\r\n        while (ctx.measureText(text + '...').width > maxWidth && len > 0) {\r\n          len = len - 1\r\n          text = text.substring(0, len)\r\n        }\r\n        text = text + '...'\r\n      }\r\n    }\r\n\r\n    console.debug('text=', text)\r\n    return text\r\n  }\r\n\r\n  async makeTextImg(item: VideoAnimateEffectType) {\r\n    if (!this.ctx) return\r\n    const ctx = this.ctx\r\n    const {fontStyle, fontColor, fontSize} = item\r\n    //\r\n    const w = item.effectWidth\r\n    const h = item.effectHeight\r\n    ctx.canvas.width = w\r\n    ctx.canvas.height = h\r\n    ctx.textBaseline = 'middle'\r\n    ctx.textAlign = 'center'\r\n    const txt = item.text || ''\r\n    const getFontStyle = (fontSize?: number) => {\r\n      fontSize = fontSize || Math.min(w / txt.length, h - 8) // 需留一定间隙\r\n      const font = ['600', `${Math.round(fontSize)}px`, 'Microsoft YaHei']\r\n      if (fontStyle === 'b') {\r\n        font.unshift('bold')\r\n      }\r\n      return font.join(' ')\r\n    }\r\n    if (!fontStyle) {\r\n      const fontStyle = getFontStyle(item.fontSize)\r\n      ctx.font = fontStyle\r\n      if (fontColor) ctx.fillStyle = fontColor\r\n    } else if (typeof fontStyle == 'string') {\r\n      ctx.font = fontStyle\r\n      if (fontColor) ctx.fillStyle = fontColor\r\n    } else if (typeof fontStyle == 'object') {\r\n      ctx.font = fontStyle['font'] || getFontStyle()\r\n      ctx.fillStyle = fontStyle['color'] || fontColor\r\n    } else if (typeof fontStyle == 'function') {\r\n      ctx.font = getFontStyle(fontSize)\r\n      if (fontColor) ctx.fillStyle = fontColor\r\n      fontStyle(null, ctx, item)\r\n    }\r\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n    ctx.fillText(this._getText(ctx, txt, w), w / 2, h / 2)\r\n    return ctx.getImageData(0, 0, w, h)\r\n  }\r\n  async makeImage(item: VideoAnimateEffectType, url: string) {\r\n    if (!this.ctx) return\r\n    const ctx = this.ctx\r\n    const w = item.effectWidth\r\n    const h = item.effectHeight\r\n    if (!url) {\r\n      ctx.clearRect(0, 0, w, h)\r\n      return ctx.getImageData(0, 0, w, h)\r\n    }\r\n    //\r\n    const img = await this.createImage(url)\r\n    ctx.canvas.width = w\r\n    ctx.canvas.height = h\r\n    let drawWidth = w\r\n    let drawHeight = h\r\n    let sx = 0\r\n    let sy = 0\r\n    //\r\n    // console.log(`item.scaleMode`, item.scaleMode)\r\n    if (item.scaleMode) {\r\n      switch (item.scaleMode) {\r\n        case EScaleMode.aspectFill: // 最大适配\r\n          {\r\n            let adapt = 1\r\n            if (w / h > img.width / img.height) {\r\n              adapt = w / img.width\r\n            } else {\r\n              adapt = h / img.height\r\n            }\r\n            drawWidth = Math.round(img.width * adapt)\r\n            drawHeight = Math.round(img.height * adapt)\r\n            sx = -Math.round(Math.abs(drawWidth - w) / 2)\r\n            sy = -Math.round(Math.abs(drawHeight - h) / 2)\r\n          }\r\n          break\r\n        case EScaleMode.aspectFit: // 最小适配\r\n          {\r\n            let adapt = 1\r\n            if (w / h < img.width / img.height) {\r\n              adapt = w / img.width\r\n            } else {\r\n              adapt = h / img.height\r\n            }\r\n            drawWidth = Math.round(img.width * adapt)\r\n            drawHeight = Math.round(img.height * adapt)\r\n            sx = -Math.round(Math.abs(drawWidth - w) / 2)\r\n            sy = -Math.round(Math.abs(drawHeight - h) / 2)\r\n          }\r\n          break\r\n        case EScaleMode.scaleFill: // 变形适配\r\n          break\r\n        default:\r\n      }\r\n    }\r\n    ctx.save()\r\n    ctx.translate(0, 0)\r\n    ctx.scale(1, 1)\r\n    ctx.drawImage(img, sx, sy, drawWidth, drawHeight)\r\n    ctx.restore()\r\n    return ctx.getImageData(0, 0, w, h)\r\n  }\r\n  createImage(url: string): Promise<WechatMiniprogram.Image> {\r\n    return new Promise((resovle, reject) => {\r\n      const canvas = wx.createOffscreenCanvas({type: '2d', width: 300, height: 300})\r\n      const image = canvas.createImage()\r\n      image.src = url\r\n      image.onload = () => {\r\n        resovle(image)\r\n      }\r\n      image.onerror = e => reject(e)\r\n    })\r\n  }\r\n}\r\n","import {platform} from './utils'\r\nimport EffectKey from './effectKey'\r\nimport {\r\n  PlayerOptionsType,\r\n  VideoAnimateType,\r\n  VideoInfoType,\r\n  VideoAnimateEffectType,\r\n  ModeType,\r\n  RgbaPosType,\r\n} from './types'\r\nimport {systemInfo, dpr} from './utils'\r\nexport const PER_SIZE = 9\r\nexport default class WebGL {\r\n  texture: any\r\n  gl: any\r\n  op!: PlayerOptionsType\r\n  program: any\r\n  metadatas?: VideoAnimateType\r\n  textureMap: any\r\n  efectKey!: EffectKey\r\n  buffers: any\r\n  textures: any\r\n  canvasVideo!: any\r\n  public destory() {\r\n    this.clear()\r\n    this.texture = undefined\r\n    this.op = undefined\r\n    this.program = undefined\r\n    this.textureMap = undefined\r\n    this.efectKey = undefined\r\n    this.buffers = undefined\r\n    this.textures = undefined\r\n    this.canvasVideo = undefined\r\n  }\r\n  constructor() {\r\n    this.textureMap = {}\r\n    this.buffers = {}\r\n    this.textures = {}\r\n    /**\r\n     * 处理图片内容\r\n     */\r\n  }\r\n  async setup(op: PlayerOptionsType, metadatas?: VideoAnimateType) {\r\n    //\r\n    this.op = op\r\n    this.metadatas = metadatas\r\n    this.efectKey = new EffectKey(op)\r\n    //\r\n    const o = {\r\n      alpha: true, //指示Canvas是否含有透明通道，若设置为false不透明，如果Canvas下叠加了其他元素时，可以在绘制时提升一些性能\r\n      antialias: false, //绘制时是否开启抗锯齿功能\r\n      depth: true, //是否开启深度缓冲功能\r\n      failIfMajorPerformanceCaveat: false, //性能较低时，将不允许创建context。也就是是getContext()返回null [ios 会因此产生问题]\r\n      premultipliedAlpha: true, //将alpha通道预先乘入rgb通道内，以提高合成性能\r\n      stencil: false, //是否开启模板缓冲功能\r\n      preserveDrawingBuffer: false, //是否保留缓冲区数据，如果你需要读取像素，或者复用绘制到主屏幕上的图像\r\n    }\r\n    const canvas: any = op.canvas\r\n    const gl = canvas.getContext('webgl', o)\r\n    if (!gl) {\r\n      console.error('Unable to get webgl context.')\r\n      return\r\n    }\r\n    this.gl = gl\r\n    const {effect} = this.metadatas || {}\r\n    await this.efectKey.parseFromSrcAndOptions(effect)\r\n  }\r\n  /**\r\n   * video ready时触发\r\n   * @param v\r\n   * @returns\r\n   */\r\n  setOnVideoInit(v: VideoInfoType) {\r\n    //\r\n    // const systemInfo = wx.getSystemInfoSync()\r\n    const {descript, effect} = this.metadatas || {}\r\n    const gl = this.gl\r\n    const op = this.op\r\n    // const dpr = 1\r\n\r\n    const cv: any = {}\r\n    if (!descript) {\r\n      cv.width = v.width ? (v.width / 2) * dpr : 900\r\n      cv.height = v.height ? v.height * dpr : 1000\r\n    } else {\r\n      const [x, y, w, h] = descript.rgbFrame\r\n      cv.width = w * dpr\r\n      cv.height = h * dpr\r\n    }\r\n    this.canvasVideo = cv\r\n    //\r\n    if (platform === 'ios') {\r\n      gl.canvas.width = op.canvasClient.width * dpr\r\n      gl.canvas.height = op.canvasClient.height * dpr\r\n    } else {\r\n      gl.canvas.width = cv.width\r\n      gl.canvas.height = cv.height\r\n    }\r\n    // console.log('this.canvasVideo', cv)\r\n\r\n    //\r\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight)\r\n    //=================== 混合功能，将片元颜色和颜色缓冲区的颜色进行混合\r\n    gl.disable(gl.BLEND)\r\n    //=================== 分别设置应用在 RGB 和 Alpha 上的 factor。比如我们不想修改混合颜色之后的 Alpha 值，可以这样做\r\n    gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n    //=================== 对纹理图像进行y轴反转，\r\n    // 因为WebGL纹理坐标系统的t轴（分为t轴和s轴）的方向和图片的坐标系统Y轴方向相反。因此将Y轴进行反转。\r\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true)\r\n    // === createShaderProgram ===\r\n    const {fs, vs} = this.getVSFS()\r\n    const vertexShader = this.createShader(gl, vs, gl.VERTEX_SHADER)\r\n    const fragmentShader = this.createShader(gl, fs, gl.FRAGMENT_SHADER)\r\n    const program = this.createProgram(gl, vertexShader, fragmentShader)\r\n    if (!program) return\r\n    this.program = program\r\n    gl.useProgram(program)\r\n    // === createTexture ===\r\n    this.initTexture(effect)\r\n    // === createProgramInfo ===\r\n    const aVertexPosition = gl.getAttribLocation(program, 'a_position')\r\n    const vertexTexCoordAttribute = gl.getAttribLocation(program, 'a_texCoord')\r\n    const aAlphaTexCoord = gl.getAttribLocation(program, 'a_alpha_texCoord')\r\n    //\r\n    gl.enableVertexAttribArray(aVertexPosition)\r\n    gl.enableVertexAttribArray(vertexTexCoordAttribute)\r\n    gl.enableVertexAttribArray(aAlphaTexCoord)\r\n\r\n    //\r\n    const view = this.getViewPos({descript, alphaDirection: op.alphaDirection, vw: v.width, vh: v.height})\r\n    this.buffers.globalBuffer = gl.createBuffer()\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffers.globalBuffer)\r\n    gl.bufferData(gl.ARRAY_BUFFER, view, gl.STATIC_DRAW)\r\n    const size = view.BYTES_PER_ELEMENT\r\n    //\r\n    gl.vertexAttribPointer(aVertexPosition, 2, gl.FLOAT, false, size * 6, 0)\r\n    gl.vertexAttribPointer(vertexTexCoordAttribute, 2, gl.FLOAT, false, size * 6, size * 2)\r\n    gl.vertexAttribPointer(aAlphaTexCoord, 2, gl.FLOAT, false, size * 6, size * 4)\r\n    //\r\n\r\n    // 设置所有的全局变量\r\n    const scaleLocation = gl.getUniformLocation(program, 'u_scale')\r\n    const scaleSize = this.getScale(op.mode)\r\n    gl.uniform2fv(scaleLocation, new Float32Array(scaleSize))\r\n  }\r\n  getFrame(frame: number) {\r\n    const {datas} = this.metadatas || {}\r\n    if (!datas) return\r\n    return (\r\n      datas &&\r\n      datas.find(item => {\r\n        return item.frameIndex === frame\r\n      })\r\n    )\r\n  }\r\n  renderDesc(frame: number) {\r\n    const {descript} = this.metadatas || {}\r\n    const gl = this.gl\r\n    const program = this.program\r\n    if (descript && frame > 0) {\r\n      let posArr: any = []\r\n      const vW = descript.width\r\n      const vH = descript.height\r\n      const frameData = this.getFrame(frame)\r\n      const frameItem = frameData ? frameData.data : undefined\r\n      if (frameItem) {\r\n        frameItem.forEach((o: any) => {\r\n          posArr[posArr.length] = +this.textureMap[o.effectId]\r\n          // frame坐标是最终展示坐标，这里glsl中计算使用视频坐标\r\n          const [rgbX, rgbY] = descript.rgbFrame\r\n          const [x, y, w, h] = o.renderFrame\r\n          const [mX, mY, mW, mH] = o.outputFrame\r\n          const coord = this.computeCoord(x + rgbX, y + rgbY, w, h, vW, vH)\r\n          const mCoord = this.computeCoord(mX, mY, mW, mH, vW, vH)\r\n          posArr = posArr.concat(coord).concat(mCoord)\r\n        })\r\n      }\r\n      const size = (gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS) - 1) * PER_SIZE\r\n      posArr = posArr.concat(new Array(size - posArr.length).fill(0))\r\n      const imgPostLocation = gl.getUniformLocation(program, 'image_pos')\r\n      gl.uniform1fv(imgPostLocation, new Float32Array(posArr))\r\n    }\r\n  }\r\n  destroy() {\r\n    this.clear()\r\n    this.efectKey.destroy()\r\n    this.texture = undefined\r\n    this.gl = undefined\r\n    this.op = undefined\r\n    this.program = undefined\r\n    this.metadatas = undefined\r\n    this.textureMap = undefined\r\n    this.efectKey = undefined\r\n    this.buffers = undefined\r\n    this.textures = undefined\r\n    this.canvasVideo = undefined\r\n  }\r\n  public clear() {\r\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\r\n  }\r\n  render(frame: number, v: WechatMiniprogram.FrameDataOptions) {\r\n    const gl = this.gl\r\n    this.renderDesc(frame)\r\n    // gl.bindTexture(gl.TEXTURE_2D, this.texture) // webchat's bug?\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, v.width, v.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array(v.data))\r\n    // gl.clear(gl.COLOR_BUFFER_BIT)\r\n    this.clear()\r\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4)\r\n  }\r\n  //\r\n  initTexture(effect?: VideoAnimateEffectType[]) {\r\n    const gl = this.gl\r\n    const program = this.program\r\n    const textureMap = this.textureMap\r\n    let i = 1\r\n    // === effect ===\r\n    if (effect) {\r\n      for (const k in effect) {\r\n        const r = effect[k]\r\n        r.img && this.createTexture(gl, i, r.img)\r\n        const sampler = gl.getUniformLocation(program, `u_image${i}`)\r\n        gl.uniform1i(sampler, i)\r\n        textureMap[r.effectId] = i++\r\n      }\r\n      // dump?\r\n      const dumpTexture = gl.createTexture()\r\n      gl.activeTexture(gl.TEXTURE0)\r\n      gl.bindTexture(gl.TEXTURE_2D, dumpTexture)\r\n      gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null)\r\n    }\r\n    //\r\n    this.createTexture(gl, i)\r\n    const uImageVideoLocation = gl.getUniformLocation(program, 'u_image_video')\r\n    gl.uniform1i(uImageVideoLocation, i)\r\n  }\r\n  createTexture(gl: any, index: number, img?: any) {\r\n    // const texture = gl.createTexture()\r\n    this.textures[index] = gl.createTexture()\r\n    const textrueIndex = gl.TEXTURE0 + index\r\n    gl.activeTexture(textrueIndex)\r\n    gl.bindTexture(gl.TEXTURE_2D, this.textures[index])\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\r\n    // gl.bindTexture(gl.TEXTURE_2D, null) // wechat bug?\r\n    if (img) {\r\n      gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n        0,\r\n        gl.RGBA,\r\n        img.width,\r\n        img.height,\r\n        0,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        new Uint8Array(img.data),\r\n      )\r\n    }\r\n  }\r\n\r\n  getScale(mode?: ModeType) {\r\n    let scaleX = 1\r\n    let scaleY = 1\r\n    // const clientWidth = container.width || systemInfo.screenWidth\r\n    // const clientHeight = container.height || systemInfo.screenHeight\r\n    // const clientWidth = systemInfo.windowWidth\r\n    // const clientHeight = systemInfo.windowHeight\r\n    const clientWidth = this.op.canvasClient.width\r\n    const clientHeight = this.op.canvasClient.height\r\n    let vw, vh\r\n    if (platform === 'ios') {\r\n      vw = this.canvasVideo.width\r\n      vh = this.canvasVideo.height\r\n    } else {\r\n      vw = this.op.canvas.width\r\n      vh = this.op.canvas.height\r\n    }\r\n    const canvasAspect = clientWidth / clientHeight\r\n    const videoAspect = vw / vh\r\n    if (mode) {\r\n      switch (mode) {\r\n        case 'AspectFill':\r\n        case 'vertical': //fit vertical | AspectFill 竖屏\r\n          scaleY = 1\r\n          scaleX = videoAspect / canvasAspect\r\n          break\r\n        case 'AspectFit':\r\n        case 'horizontal': //fit horizontal | AspectFit 横屏\r\n          scaleX = 1\r\n          scaleY = canvasAspect / videoAspect\r\n          break\r\n        case 'Fill':\r\n        case 'cover':\r\n          scaleY = 1\r\n          scaleX = videoAspect / canvasAspect\r\n          if (scaleX < 1) {\r\n            scaleY = 1 / scaleX\r\n            scaleX = 1\r\n          }\r\n          break\r\n        case 'contain':\r\n          scaleY = 1\r\n          scaleX = videoAspect / canvasAspect\r\n          if (scaleX > 1) {\r\n            scaleY = 1 / scaleX\r\n            scaleX = 1\r\n          }\r\n          break\r\n        case 'Normal':\r\n          break\r\n        default:\r\n          break\r\n      }\r\n    }\r\n    /* console.log(\r\n      '=== [getScale] ===',\r\n      mode,\r\n      'canvasAspect',\r\n      canvasAspect,\r\n      clientWidth,\r\n      clientHeight,\r\n      'videoAspect',\r\n      videoAspect,\r\n      vw,\r\n      vh,\r\n      'scale',\r\n      scaleX,\r\n      scaleY,\r\n      'safeArea',\r\n      systemInfo.safeArea,\r\n    ) */\r\n    return [scaleX, scaleY]\r\n  }\r\n  computeCoord(x: number, y: number, w: number, h: number, vw: number, vh: number) {\r\n    // leftX rightX bottomY topY\r\n    return [x / vw, (x + w) / vw, (vh - y - h) / vh, (vh - y) / vh]\r\n  }\r\n  getViewPos(o: RgbaPosType) {\r\n    const ver = []\r\n    const {rgbX, rgbY, rgbW, rgbH, vW, vH, aX, aY, aW, aH} = this.getRgbaPos(o)\r\n    const rgbCoord = this.computeCoord(rgbX, rgbY, rgbW, rgbH, vW, vH)\r\n    const aCoord = this.computeCoord(aX, aY, aW, aH, vW, vH)\r\n    ver.push(...[-1, 1, rgbCoord[0], rgbCoord[3], aCoord[0], aCoord[3]])\r\n    ver.push(...[1, 1, rgbCoord[1], rgbCoord[3], aCoord[1], aCoord[3]])\r\n    ver.push(...[-1, -1, rgbCoord[0], rgbCoord[2], aCoord[0], aCoord[2]])\r\n    ver.push(...[1, -1, rgbCoord[1], rgbCoord[2], aCoord[1], aCoord[2]])\r\n    // console.log('=== [getViewPos] ===', ver)\r\n    const view = new Float32Array(ver)\r\n    // console.log('=== [getViewPos view] ===', view)\r\n    return view\r\n  }\r\n  getRgbaPos({descript, alphaDirection, vw, vh}: RgbaPosType) {\r\n    let d\r\n    if (descript) {\r\n      //=================== 创建缓冲区\r\n      const {width: vW, height: vH} = descript\r\n      const [rgbX, rgbY, rgbW, rgbH] = descript.rgbFrame\r\n      const [aX, aY, aW, aH] = descript.alphaFrame\r\n      d = {rgbX, rgbY, rgbW, rgbH, vW, vH, aX, aY, aW, aH}\r\n    } else {\r\n      //默认为左右均分\r\n      const vW = vw ? vw : 1800\r\n      const vH = vh ? vh : 1000\r\n      const stageW = vW / 2\r\n      const [rgbX, rgbY, rgbW, rgbH] = alphaDirection === 'right' ? [0, 0, stageW, vH] : [stageW, 0, stageW, vH]\r\n      const [aX, aY, aW, aH] = alphaDirection === 'right' ? [stageW, 0, stageW, vH] : [0, 0, stageW, vH]\r\n      d = {rgbX, rgbY, rgbW, rgbH, vW, vH, aX, aY, aW, aH}\r\n    }\r\n    // console.log('=== [getRgbaPos] ===', d)\r\n    return d\r\n  }\r\n  createProgram(gl: any, vertexShader: any, fragmentShader: any) {\r\n    const program = gl.createProgram()\r\n    gl.attachShader(program, vertexShader)\r\n    gl.attachShader(program, fragmentShader)\r\n    gl.linkProgram(program)\r\n    const linked = gl.getProgramParameter(program, gl.LINK_STATUS)\r\n    if (linked) {\r\n      return program\r\n    }\r\n    gl.deleteProgram(program)\r\n    return null\r\n  }\r\n  /**\r\n   * 创建着色器\r\n   * @param gl 渲染上下文\r\n   * @param src 数据源\r\n   * @param type 着色器类型\r\n   * @returns 着色器\r\n   */\r\n  createShader(gl: any, src: any, type: any) {\r\n    const shader = gl.createShader(type)\r\n    gl.shaderSource(shader, src)\r\n    gl.compileShader(shader)\r\n\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      console.error('Error compiling shader: ' + gl.getShaderInfoLog(shader))\r\n    }\r\n    return shader\r\n  }\r\n  getVSFS() {\r\n    const gl = this.gl\r\n    const textureSize = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS) - 1\r\n    // const textureSize =0\r\n    let sourceTexure = ''\r\n    let sourceUniform = ''\r\n    if (textureSize > 0) {\r\n      const imgColor = []\r\n      const samplers = []\r\n      for (let i = 0; i < textureSize; i++) {\r\n        imgColor.push(\r\n          `if(ndx == ${i + 1}){\r\n                          color = texture2D(u_image${i + 1},uv);\r\n                      }`,\r\n        )\r\n        samplers.push(`uniform sampler2D u_image${i + 1};`)\r\n      }\r\n\r\n      sourceUniform = `\r\n              ${samplers.join('\\n')}\r\n              uniform float image_pos[${textureSize * PER_SIZE}];\r\n              vec4 getSampleFromArray(int ndx, vec2 uv) {\r\n                  vec4 color;\r\n                  ${imgColor.join(' else ')}\r\n                  return color;\r\n              }\r\n              `\r\n      sourceTexure = `\r\n              vec4 srcColor,maskColor;\r\n              vec2 srcTexcoord,maskTexcoord;\r\n              int srcIndex;\r\n              float x1,x2,y1,y2,mx1,mx2,my1,my2; //显示的区域\r\n  \r\n              for(int i=0;i<${textureSize * PER_SIZE};i+= ${PER_SIZE}){\r\n                  if ((int(image_pos[i]) > 0)) {\r\n                    srcIndex = int(image_pos[i]);\r\n                      x1 = image_pos[i+1];\r\n                      x2 = image_pos[i+2];\r\n                      y1 = image_pos[i+3];\r\n                      y2 = image_pos[i+4];\r\n  \r\n                      mx1 = image_pos[i+5];\r\n                      mx2 = image_pos[i+6];\r\n                      my1 = image_pos[i+7];\r\n                      my2 = image_pos[i+8];\r\n  \r\n                      if (v_texcoord.s>x1 && v_texcoord.s<x2 && v_texcoord.t>y1 && v_texcoord.t<y2) {\r\n                          srcTexcoord = vec2((v_texcoord.s-x1)/(x2-x1),(v_texcoord.t-y1)/(y2-y1));\r\n                           maskTexcoord = vec2(mx1+srcTexcoord.s*(mx2-mx1),my1+srcTexcoord.t*(my2-my1));\r\n                           srcColor = getSampleFromArray(srcIndex,srcTexcoord);\r\n                           maskColor = texture2D(u_image_video, maskTexcoord);\r\n                           srcColor.a = srcColor.a*(maskColor.r);\r\n                           bgColor = vec4(srcColor.rgb*srcColor.a,srcColor.a) + (1.0-srcColor.a)*bgColor;\r\n                      }\r\n                  }\r\n              }\r\n              `\r\n    }\r\n    const vs = `\r\n    attribute vec2 a_position;\r\n    attribute vec2 a_texCoord;\r\n    attribute vec2 a_alpha_texCoord;\r\n    varying vec2 v_texcoord;\r\n    varying vec2 v_alpha_texCoord;\r\n    uniform vec2 u_scale;\r\n    void main(void){\r\n      gl_Position = vec4(u_scale * a_position, 0.0, 1.0);\r\n      v_texcoord = a_texCoord;\r\n      v_alpha_texCoord = a_alpha_texCoord;\r\n    }\r\n  `\r\n    //\r\n    const bg = `vec4(texture2D(u_image_video, v_texcoord).rgb, texture2D(u_image_video,v_alpha_texCoord).r)`\r\n    const fs = `\r\n    precision lowp float;\r\n    varying vec2 v_texcoord;\r\n    varying vec2 v_alpha_texCoord;\r\n    uniform sampler2D u_image_video;\r\n    ${sourceUniform}\r\n    void main(void) {\r\n      vec4 bgColor = ${bg};\r\n      ${sourceTexure}\r\n      gl_FragColor = bgColor;\r\n    }\r\n  `\r\n    return {fs, vs}\r\n  }\r\n}\r\n","export const BTYPE = Object.freeze({\r\n  UNCOMPRESSED: 0,\r\n  FIXED: 1,\r\n  DYNAMIC: 2,\r\n});\r\n\r\nexport const BLOCK_MAX_BUFFER_LEN = 131072;\r\n\r\nexport const LENGTH_EXTRA_BIT_LEN = [\r\n  0, 0, 0, 0, 0, 0, 0, 0, 1, 1,\r\n  1, 1, 2, 2, 2, 2, 3, 3, 3, 3,\r\n  4, 4, 4, 4, 5, 5, 5, 5, 0,\r\n];\r\n\r\nexport const LENGTH_EXTRA_BIT_BASE = [\r\n  3,  4,  5,  6,   7,   8,   9,   10,  11,  13,\r\n  15, 17, 19, 23,  27,  31,  35,  43,  51,  59,\r\n  67, 83, 99, 115, 131, 163, 195, 227, 258,\r\n];\r\n\r\nexport const DISTANCE_EXTRA_BIT_BASE = [\r\n  1, 2, 3, 4, 5, 7, 9, 13, 17, 25,\r\n  33, 49, 65, 97, 129, 193, 257, 385, 513, 769,\r\n  1025, 1537, 2049, 3073, 4097, 6145,\r\n  8193, 12289, 16385, 24577,\r\n];\r\nexport const DISTANCE_EXTRA_BIT_LEN = [\r\n  0, 0, 0,  0,  1,  1,  2,  2,  3,  3,\r\n  4, 4, 5,  5,  6,  6,  7,  7,  8,  8,\r\n  9, 9, 10, 10, 11, 11, 12, 12, 13, 13,\r\n];\r\n\r\nexport const CODELEN_VALUES = [\r\n  16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15,\r\n];\r\n","export interface ICodelenValues {\r\n  [key: number]: number[];\r\n}\r\nexport interface IHuffmanTable {\r\n  [key: number]: {[key: number]: number};\r\n}\r\n\r\nexport function generateHuffmanTable(codelenValues: ICodelenValues): IHuffmanTable {\r\n  const codelens = Object.keys(codelenValues);\r\n  let codelen = 0;\r\n  let codelenMax = 0;\r\n  let codelenMin = Number.MAX_SAFE_INTEGER;\r\n  codelens.forEach((key) => {\r\n    codelen = Number(key);\r\n    if (codelenMax < codelen) { codelenMax = codelen; }\r\n    if (codelenMin > codelen) { codelenMin = codelen; }\r\n  });\r\n\r\n  let code = 0;\r\n  let values: number[];\r\n  const bitlenTables: IHuffmanTable = {};\r\n  for (let bitlen = codelenMin; bitlen <= codelenMax; bitlen++) {\r\n    values = codelenValues[bitlen];\r\n    if (values === undefined) { values = []; }\r\n    values.sort((a, b) => {\r\n      if ( a < b ) { return -1; }\r\n      if ( a > b ) { return 1; }\r\n      return 0;\r\n    });\r\n    const table: {[key: number]: number} = {};\r\n    values.forEach((value) => {\r\n      table[code] = value;\r\n      code++;\r\n    });\r\n    bitlenTables[bitlen] = table;\r\n    code <<= 1;\r\n  }\r\n  return bitlenTables;\r\n}\r\n\r\nexport function makeFixedHuffmanCodelenValues(): ICodelenValues {\r\n  const codelenValues: ICodelenValues = {};\r\n  codelenValues[7] = [];\r\n  codelenValues[8] = [];\r\n  codelenValues[9] = [];\r\n  for (let i = 0; i <= 287; i++) {\r\n    (i <= 143) ? codelenValues[8].push(i) :\r\n    (i <= 255) ? codelenValues[9].push(i) :\r\n    (i <= 279) ? codelenValues[7].push(i) :\r\n    codelenValues[8].push(i);\r\n  }\r\n  return codelenValues;\r\n}\r\n\r\nexport function generateDeflateHuffmanTable(\r\n  values: number[],\r\n  maxLength: number = 15,\r\n  ): Map<number, {code: number, bitlen: number}> {\r\n  const valuesCount: {[key: number]: number} = {};\r\n  for (const value of values) {\r\n    if (!valuesCount[value]) {\r\n      valuesCount[value] = 1;\r\n    } else {\r\n      valuesCount[value]++;\r\n    }\r\n  }\r\n  const valuesCountKeys = Object.keys(valuesCount);\r\n  let tmpPackages: Array<{count: number, simbles: number[]}> = [];\r\n  let tmpPackageIndex = 0;\r\n  let packages: Array<{count: number, simbles: number[]}> = [];\r\n  if (valuesCountKeys.length === 1) {\r\n    packages.push({\r\n      count: valuesCount[0],\r\n      simbles: [Number(valuesCountKeys[0])],\r\n    });\r\n  } else {\r\n    for (let i = 0; i < maxLength; i++) {\r\n      packages = [];\r\n      valuesCountKeys.forEach((value) => {\r\n        const pack = {\r\n          count: valuesCount[Number(value)],\r\n          simbles: [Number(value)],\r\n        };\r\n        packages.push(pack);\r\n      });\r\n      tmpPackageIndex = 0;\r\n      while (tmpPackageIndex + 2 <= tmpPackages.length) {\r\n        const pack = {\r\n          count: tmpPackages[tmpPackageIndex].count + tmpPackages[tmpPackageIndex + 1].count,\r\n          simbles: tmpPackages[tmpPackageIndex].simbles.concat(tmpPackages[tmpPackageIndex + 1].simbles),\r\n        };\r\n        packages.push(pack);\r\n        tmpPackageIndex += 2;\r\n      }\r\n      packages = packages.sort((a: any, b: any) => {\r\n        if ( a.count < b.count ) { return -1; }\r\n        if ( a.count > b.count ) { return 1; }\r\n        return 0;\r\n      });\r\n      if (packages.length % 2 !== 0) {\r\n        packages.pop();\r\n      }\r\n      tmpPackages = packages;\r\n    }\r\n  }\r\n  const valuesCodelen: {[key: number]: number} = {};\r\n  packages.forEach((pack) => {\r\n    pack.simbles.forEach((symble) => {\r\n      if (!valuesCodelen[symble]) {\r\n        valuesCodelen[symble] = 1;\r\n      } else {\r\n        valuesCodelen[symble]++;\r\n      }\r\n    });\r\n  });\r\n\r\n  let group: number[];\r\n  const valuesCodelenKeys = Object.keys(valuesCodelen);\r\n  const codelenGroup: {[key: number]: number[]} = {};\r\n  let code = 0;\r\n  let codelen = 3;\r\n  const codelenMax = codelen;\r\n  let codelenValueMin = Number.MAX_SAFE_INTEGER;\r\n  let codelenValueMax = 0;\r\n  valuesCodelenKeys.forEach((valuesCodelenKey) => {\r\n    codelen = valuesCodelen[Number(valuesCodelenKey)];\r\n    if (!codelenGroup[codelen]) {\r\n      codelenGroup[codelen] = [];\r\n      if (codelenValueMin > codelen) { codelenValueMin = codelen; }\r\n      if (codelenValueMax < codelen) { codelenValueMax = codelen; }\r\n    }\r\n    codelenGroup[codelen].push(Number(valuesCodelenKey));\r\n  });\r\n\r\n  code = 0;\r\n  const table = new Map<number, {code: number, bitlen: number}>();\r\n  for (let i = codelenValueMin; i <= codelenValueMax; i++) {\r\n    group = codelenGroup[i];\r\n    if (group) {\r\n      group = group.sort((a, b) => {\r\n        if ( a < b ) { return -1; }\r\n        if ( a > b ) { return 1; }\r\n        return 0;\r\n      });\r\n      group.forEach((value) => {\r\n        table.set(value, {code, bitlen: i});\r\n        code++;\r\n      });\r\n    }\r\n    code <<= 1;\r\n  }\r\n  return table;\r\n}\r\n","export class BitReadStream {\r\n  public buffer: Uint8Array\r\n  public bufferIndex: number\r\n  public nowBits: number\r\n  public nowBitsLength: number\r\n  public isEnd: boolean\r\n  constructor(buffer: Uint8Array, offset = 0) {\r\n    this.buffer = buffer\r\n    this.bufferIndex = offset\r\n    this.nowBits = buffer[offset]\r\n    this.nowBitsLength = 8\r\n    this.isEnd = false\r\n  }\r\n\r\n  public read() {\r\n    if (this.isEnd) {\r\n      throw new Error('Lack of data length')\r\n    }\r\n    const bit = this.nowBits & 1\r\n    if (this.nowBitsLength > 1) {\r\n      this.nowBitsLength--\r\n      this.nowBits >>= 1\r\n    } else {\r\n      this.bufferIndex++\r\n      if (this.bufferIndex < this.buffer.length) {\r\n        this.nowBits = this.buffer[this.bufferIndex]\r\n        this.nowBitsLength = 8\r\n      } else {\r\n        this.nowBitsLength = 0\r\n        this.isEnd = true\r\n      }\r\n    }\r\n    return bit\r\n  }\r\n  public readRange(length: number) {\r\n    while (this.nowBitsLength <= length) {\r\n      this.nowBits |= this.buffer[++this.bufferIndex] << this.nowBitsLength\r\n      this.nowBitsLength += 8\r\n    }\r\n    const bits = this.nowBits & ((1 << length) - 1)\r\n    this.nowBits >>>= length\r\n    this.nowBitsLength -= length\r\n    return bits\r\n  }\r\n  public readRangeCoded(length: number) {\r\n    let bits = 0\r\n    for (let i = 0; i < length; i++) {\r\n      bits <<= 1\r\n      bits |= this.read()\r\n    }\r\n    return bits\r\n  }\r\n}\r\n","export class Uint8WriteStream {\r\n  public index: number\r\n  public buffer: Uint8Array\r\n  public length: number\r\n  private _extendedSize: number\r\n\r\n  constructor(extendedSize: number) {\r\n    this.buffer = new Uint8Array(extendedSize)\r\n    this.length = extendedSize\r\n    this._extendedSize = extendedSize\r\n    this.index = 0\r\n  }\r\n  public write(value: number) {\r\n    if (this.length <= this.index) {\r\n      this.length += this._extendedSize\r\n      const newBuffer = new Uint8Array(this.length)\r\n      const nowSize = this.buffer.length\r\n      for (let i = 0; i < nowSize; i++) {\r\n        newBuffer[i] = this.buffer[i]\r\n      }\r\n      this.buffer = newBuffer\r\n    }\r\n    this.buffer[this.index] = value\r\n    this.index++\r\n  }\r\n}\r\n","import {\r\n  BLOCK_MAX_BUFFER_LEN,\r\n  BTYPE,\r\n  CODELEN_VALUES,\r\n  DISTANCE_EXTRA_BIT_BASE,\r\n  DISTANCE_EXTRA_BIT_LEN,\r\n  LENGTH_EXTRA_BIT_BASE,\r\n  LENGTH_EXTRA_BIT_LEN,\r\n} from './const';\r\nimport {generateHuffmanTable, ICodelenValues, makeFixedHuffmanCodelenValues} from './huffman';\r\nimport {BitReadStream} from './utils/BitReadStream';\r\nimport {Uint8WriteStream} from './utils/Uint8WriteStream';\r\n\r\nconst FIXED_HUFFMAN_TABLE = generateHuffmanTable( makeFixedHuffmanCodelenValues() );\r\n\r\nexport function inflate(input: Uint8Array, offset: number = 0) {\r\n  const buffer = new Uint8WriteStream(input.length * 10);\r\n\r\n  const stream = new BitReadStream(input, offset);\r\n  let bFinal = 0;\r\n  let bType = 0;\r\n  while (bFinal !== 1) {\r\n    bFinal = stream.readRange(1);\r\n    bType = stream.readRange(2);\r\n    if (bType === BTYPE.UNCOMPRESSED) {\r\n      inflateUncompressedBlock(stream, buffer);\r\n    } else if (bType === BTYPE.FIXED) {\r\n      inflateFixedBlock(stream, buffer);\r\n    } else if (bType === BTYPE.DYNAMIC) {\r\n      inflateDynamicBlock(stream, buffer);\r\n    } else {\r\n      throw new Error('Not supported BTYPE : ' + bType);\r\n    }\r\n    if (bFinal === 0 && stream.isEnd) {\r\n      throw new Error('Data length is insufficient');\r\n    }\r\n  }\r\n\r\n  return buffer.buffer.subarray(0, buffer.index);\r\n}\r\n\r\nfunction inflateUncompressedBlock(stream: BitReadStream, buffer: Uint8WriteStream) {\r\n  // Skip to byte boundary\r\n  if (stream.nowBitsLength < 8) {\r\n    stream.readRange(stream.nowBitsLength);\r\n  }\r\n  const LEN = stream.readRange(8) | stream.readRange(8) << 8;\r\n  const NLEN = stream.readRange(8) | stream.readRange(8) << 8;\r\n  if ((LEN + NLEN) !== 65535) {\r\n    throw new Error('Data is corrupted');\r\n  }\r\n  for (let i = 0; i < LEN; i++) {\r\n    buffer.write(stream.readRange(8));\r\n  }\r\n}\r\n\r\nfunction inflateFixedBlock(stream: BitReadStream, buffer: Uint8WriteStream) {\r\n  const tables = FIXED_HUFFMAN_TABLE;\r\n\r\n  const codelens = Object.keys(tables);\r\n  let codelen = 0;\r\n  let codelenMax = 0;\r\n  let codelenMin = Number.MAX_SAFE_INTEGER;\r\n  codelens.forEach((key) => {\r\n    codelen = Number(key);\r\n    if (codelenMax < codelen) { codelenMax = codelen; }\r\n    if (codelenMin > codelen) { codelenMin = codelen; }\r\n  });\r\n  let code = 0;\r\n  let value;\r\n  let repeatLengthCode;\r\n  let repeatLengthValue;\r\n  let repeatLengthExt;\r\n  let repeatDistanceCode;\r\n  let repeatDistanceValue;\r\n  let repeatDistanceExt;\r\n  let repeatStartIndex;\r\n  while (!stream.isEnd) {\r\n    value = undefined;\r\n    codelen = codelenMin;\r\n    code = stream.readRangeCoded(codelenMin);\r\n    while (true) {\r\n      value = tables[codelen][code];\r\n      if (value !== undefined) {\r\n        break;\r\n      }\r\n      if (codelenMax <= codelen) {\r\n        throw new Error('Data is corrupted');\r\n      }\r\n      codelen++;\r\n      code <<= 1;\r\n      code |= stream.read();\r\n    }\r\n    if (value < 256) {\r\n      buffer.write(value);\r\n      continue;\r\n    }\r\n    if (value === 256) {\r\n      break;\r\n    }\r\n    repeatLengthCode = value - 257;\r\n    repeatLengthValue = LENGTH_EXTRA_BIT_BASE[repeatLengthCode];\r\n    repeatLengthExt = LENGTH_EXTRA_BIT_LEN[repeatLengthCode];\r\n    if (0 < repeatLengthExt) {\r\n      repeatLengthValue += stream.readRange(repeatLengthExt);\r\n    }\r\n    repeatDistanceCode = stream.readRangeCoded(5);\r\n    repeatDistanceValue = DISTANCE_EXTRA_BIT_BASE[repeatDistanceCode];\r\n    repeatDistanceExt = DISTANCE_EXTRA_BIT_LEN[repeatDistanceCode];\r\n    if (0 < repeatDistanceExt) {\r\n      repeatDistanceValue += stream.readRange(repeatDistanceExt);\r\n    }\r\n    repeatStartIndex = buffer.index - repeatDistanceValue;\r\n    for (let i = 0; i < repeatLengthValue; i++) {\r\n      buffer.write(buffer.buffer[repeatStartIndex + i]);\r\n    }\r\n  }\r\n}\r\n\r\nfunction inflateDynamicBlock(stream: BitReadStream, buffer: Uint8WriteStream) {\r\n  const HLIT = stream.readRange(5) + 257;\r\n  const HDIST = stream.readRange(5) + 1;\r\n  const HCLEN = stream.readRange(4) + 4;\r\n\r\n  let codelenCodelen = 0;\r\n  const codelenCodelenValues: ICodelenValues = {};\r\n  for (let i = 0; i < HCLEN; i++) {\r\n    codelenCodelen = stream.readRange(3);\r\n    if (codelenCodelen === 0) {\r\n      continue;\r\n    }\r\n    if (!codelenCodelenValues[codelenCodelen]) {\r\n      codelenCodelenValues[codelenCodelen] = [];\r\n    }\r\n    codelenCodelenValues[codelenCodelen].push(CODELEN_VALUES[i]);\r\n  }\r\n  const codelenHuffmanTables = generateHuffmanTable(codelenCodelenValues);\r\n\r\n  const codelenCodelens = Object.keys(codelenHuffmanTables);\r\n  let codelenCodelenMax = 0;\r\n  let codelenCodelenMin = Number.MAX_SAFE_INTEGER;\r\n  codelenCodelens.forEach((key) => {\r\n    codelenCodelen = Number(key);\r\n    if (codelenCodelenMax < codelenCodelen) { codelenCodelenMax = codelenCodelen; }\r\n    if (codelenCodelenMin > codelenCodelen) { codelenCodelenMin = codelenCodelen; }\r\n  });\r\n\r\n  const dataCodelenValues: ICodelenValues = {};\r\n  const distanceCodelenValues: ICodelenValues = {};\r\n  let codelenCode = 0;\r\n  let runlengthCode;\r\n  let repeat = 0;\r\n  let codelen = 0;\r\n  const codesNumber = HLIT + HDIST;\r\n\r\n  for (let i = 0; i < codesNumber;) {\r\n    runlengthCode = undefined;\r\n    codelenCodelen = codelenCodelenMin;\r\n    codelenCode = stream.readRangeCoded(codelenCodelenMin);\r\n    while (true) {\r\n      runlengthCode = codelenHuffmanTables[codelenCodelen][codelenCode];\r\n      if (runlengthCode !== undefined) {\r\n        break;\r\n      }\r\n      if (codelenCodelenMax <= codelenCodelen) {\r\n        throw new Error('Data is corrupted');\r\n      }\r\n      codelenCodelen++;\r\n      codelenCode <<= 1;\r\n      codelenCode |= stream.read();\r\n    }\r\n    if (runlengthCode === 16) {\r\n      repeat = 3 + stream.readRange(2);\r\n    } else if (runlengthCode === 17) {\r\n      repeat = 3 + stream.readRange(3);\r\n      codelen = 0;\r\n    } else if (runlengthCode === 18) {\r\n      repeat = 11 + stream.readRange(7);\r\n      codelen = 0;\r\n    } else {\r\n      repeat = 1;\r\n      codelen = runlengthCode;\r\n    }\r\n    if (codelen <= 0) {\r\n      i += repeat;\r\n    } else {\r\n      while (repeat) {\r\n        if (i < HLIT) {\r\n          if (!dataCodelenValues[codelen]) {\r\n            dataCodelenValues[codelen] = [];\r\n          }\r\n          dataCodelenValues[codelen].push(i++);\r\n        } else {\r\n          if (!distanceCodelenValues[codelen]) {\r\n            distanceCodelenValues[codelen] = [];\r\n          }\r\n          distanceCodelenValues[codelen].push(i++ - HLIT);\r\n        }\r\n        repeat--;\r\n      }\r\n    }\r\n  }\r\n  const dataHuffmanTables = generateHuffmanTable(dataCodelenValues);\r\n  const distanceHuffmanTables = generateHuffmanTable(distanceCodelenValues);\r\n\r\n  const dataCodelens = Object.keys(dataHuffmanTables);\r\n  let dataCodelen = 0;\r\n  let dataCodelenMax = 0;\r\n  let dataCodelenMin = Number.MAX_SAFE_INTEGER;\r\n  dataCodelens.forEach((key) => {\r\n    dataCodelen = Number(key);\r\n    if (dataCodelenMax < dataCodelen) { dataCodelenMax = dataCodelen; }\r\n    if (dataCodelenMin > dataCodelen) { dataCodelenMin = dataCodelen; }\r\n  });\r\n\r\n  const distanceCodelens = Object.keys(distanceHuffmanTables);\r\n  let distanceCodelen = 0;\r\n  let distanceCodelenMax = 0;\r\n  let distanceCodelenMin = Number.MAX_SAFE_INTEGER;\r\n  distanceCodelens.forEach((key) => {\r\n    distanceCodelen = Number(key);\r\n    if (distanceCodelenMax < distanceCodelen) { distanceCodelenMax = distanceCodelen; }\r\n    if (distanceCodelenMin > distanceCodelen) { distanceCodelenMin = distanceCodelen; }\r\n  });\r\n\r\n  let dataCode = 0;\r\n  let data;\r\n  let repeatLengthCode;\r\n  let repeatLengthValue;\r\n  let repeatLengthExt;\r\n  let repeatDistanceCode;\r\n  let repeatDistanceValue;\r\n  let repeatDistanceExt;\r\n  let repeatDistanceCodeCodelen;\r\n  let repeatDistanceCodeCode;\r\n  let repeatStartIndex;\r\n  while (!stream.isEnd) {\r\n    data = undefined;\r\n    dataCodelen = dataCodelenMin;\r\n    dataCode = stream.readRangeCoded(dataCodelenMin);\r\n    while (true) {\r\n      data = dataHuffmanTables[dataCodelen][dataCode];\r\n      if (data !== undefined) {\r\n        break;\r\n      }\r\n      if (dataCodelenMax <= dataCodelen) {\r\n        throw new Error('Data is corrupted');\r\n      }\r\n      dataCodelen++;\r\n      dataCode <<= 1;\r\n      dataCode |= stream.read();\r\n    }\r\n    if (data < 256) {\r\n      buffer.write(data);\r\n      continue;\r\n    }\r\n    if (data === 256) {\r\n      break;\r\n    }\r\n    repeatLengthCode = data - 257;\r\n    repeatLengthValue = LENGTH_EXTRA_BIT_BASE[repeatLengthCode];\r\n    repeatLengthExt = LENGTH_EXTRA_BIT_LEN[repeatLengthCode];\r\n    if (0 < repeatLengthExt) {\r\n      repeatLengthValue += stream.readRange(repeatLengthExt);\r\n    }\r\n\r\n    repeatDistanceCode = undefined;\r\n    repeatDistanceCodeCodelen = distanceCodelenMin;\r\n    repeatDistanceCodeCode = stream.readRangeCoded(distanceCodelenMin);\r\n    while (true) {\r\n      repeatDistanceCode = distanceHuffmanTables[repeatDistanceCodeCodelen][repeatDistanceCodeCode];\r\n      if (repeatDistanceCode !== undefined) {\r\n        break;\r\n      }\r\n      if (distanceCodelenMax <= repeatDistanceCodeCodelen) {\r\n        throw new Error('Data is corrupted');\r\n      }\r\n      repeatDistanceCodeCodelen++;\r\n      repeatDistanceCodeCode <<= 1;\r\n      repeatDistanceCodeCode |= stream.read();\r\n    }\r\n    repeatDistanceValue = DISTANCE_EXTRA_BIT_BASE[repeatDistanceCode];\r\n    repeatDistanceExt = DISTANCE_EXTRA_BIT_LEN[repeatDistanceCode];\r\n    if (0 < repeatDistanceExt) {\r\n      repeatDistanceValue += stream.readRange(repeatDistanceExt);\r\n    }\r\n    repeatStartIndex = buffer.index - repeatDistanceValue;\r\n    for (let i = 0; i < repeatLengthValue; i++) {\r\n      buffer.write(buffer.buffer[repeatStartIndex + i]);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @license Copyright (c) 2018 zprodev\r\n */\r\n\r\nimport {calcAdler32} from './adler32'\r\nimport {deflate as deflateCore} from './deflate'\r\nimport {inflate as inflateCore} from './inflate'\r\nimport {BitReadStream} from './utils/BitReadStream'\r\nimport {BitWriteStream} from './utils/BitWriteStream'\r\n\r\nexport function inflate(input: Uint8Array) {\r\n  const stream = new BitReadStream(input)\r\n  const CM = stream.readRange(4)\r\n  if (CM !== 8) {\r\n    throw new Error('Not compressed by deflate')\r\n  }\r\n  const CINFO = stream.readRange(4)\r\n  const FCHECK = stream.readRange(5)\r\n  const FDICT = stream.readRange(1)\r\n  const FLEVEL = stream.readRange(2)\r\n\r\n  return inflateCore(input, 2)\r\n}\r\n\r\nexport function deflate(input: Uint8Array) {\r\n  const data = deflateCore(input)\r\n\r\n  const CMF = new BitWriteStream(new Uint8Array(1))\r\n  CMF.writeRange(8, 4)\r\n  CMF.writeRange(7, 4)\r\n  const FLG = new BitWriteStream(new Uint8Array(1))\r\n  FLG.writeRange(28, 5)\r\n  FLG.writeRange(0, 1)\r\n  FLG.writeRange(2, 2)\r\n  const ADLER32 = new BitWriteStream(new Uint8Array(4))\r\n  const adler32 = calcAdler32(input)\r\n  ADLER32.writeRange(adler32 >>> 24, 8)\r\n  ADLER32.writeRange((adler32 >>> 16) & 0xff, 8)\r\n  ADLER32.writeRange((adler32 >>> 8) & 0xff, 8)\r\n  ADLER32.writeRange(adler32 & 0xff, 8)\r\n\r\n  const output = new Uint8Array(data.length + 6)\r\n  output.set(CMF.buffer)\r\n  output.set(FLG.buffer, 1)\r\n  output.set(data, 2)\r\n  output.set(ADLER32.buffer, output.length - 4)\r\n\r\n  return output\r\n}\r\n","const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\r\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/\r\n\r\n// btoa\r\nexport const weBtoa = function (string: string) {\r\n  string = String(string)\r\n  let bitmap,\r\n    a,\r\n    b,\r\n    c,\r\n    result = '',\r\n    i = 0,\r\n    // eslint-disable-next-line prefer-const\r\n    rest = string.length % 3\r\n\r\n  for (; i < string.length; ) {\r\n    if ((a = string.charCodeAt(i++)) > 255 || (b = string.charCodeAt(i++)) > 255 || (c = string.charCodeAt(i++)) > 255)\r\n      throw new TypeError(\r\n        \"Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.\",\r\n      )\r\n\r\n    bitmap = (a << 16) | (b << 8) | c\r\n    result +=\r\n      b64.charAt((bitmap >> 18) & 63) +\r\n      b64.charAt((bitmap >> 12) & 63) +\r\n      b64.charAt((bitmap >> 6) & 63) +\r\n      b64.charAt(bitmap & 63)\r\n  }\r\n\r\n  return rest ? result.slice(0, rest - 3) + '==='.substring(rest) : result\r\n}\r\n// atob\r\nexport const weAtob = function (string: string) {\r\n  string = String(string).replace(/[\\t\\n\\f\\r ]+/g, '')\r\n  if (!b64re.test(string))\r\n    throw new TypeError(\"Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.\")\r\n  string += '=='.slice(2 - (string.length & 3))\r\n  let bitmap,\r\n    result = '',\r\n    r1,\r\n    r2,\r\n    i = 0\r\n  for (; i < string.length; ) {\r\n    bitmap =\r\n      (b64.indexOf(string.charAt(i++)) << 18) |\r\n      (b64.indexOf(string.charAt(i++)) << 12) |\r\n      ((r1 = b64.indexOf(string.charAt(i++))) << 6) |\r\n      (r2 = b64.indexOf(string.charAt(i++)))\r\n\r\n    result +=\r\n      r1 === 64\r\n        ? String.fromCharCode((bitmap >> 16) & 255)\r\n        : r2 === 64\r\n        ? String.fromCharCode((bitmap >> 16) & 255, (bitmap >> 8) & 255)\r\n        : String.fromCharCode((bitmap >> 16) & 255, (bitmap >> 8) & 255, bitmap & 255)\r\n  }\r\n  return result\r\n}\r\n\r\n// @quote https://github.com/auth0/jwt-decode\r\nfunction b64DecodeUnicode(str: string) {\r\n  return decodeURIComponent(\r\n    weAtob(str).replace(/(.)/g, function (p) {\r\n      let code = p.charCodeAt(0).toString(16).toUpperCase()\r\n      if (code.length < 2) {\r\n        code = '0' + code\r\n      }\r\n      return '%' + code\r\n    }),\r\n  )\r\n}\r\n\r\nfunction base64_url_decode(str: string) {\r\n  let output = str.replace(/-/g, '+').replace(/_/g, '/')\r\n  switch (output.length % 4) {\r\n    case 0:\r\n      break\r\n    case 2:\r\n      output += '=='\r\n      break\r\n    case 3:\r\n      output += '='\r\n      break\r\n    default:\r\n      throw 'Illegal base64url string!'\r\n  }\r\n\r\n  try {\r\n    return b64DecodeUnicode(output)\r\n  } catch (err) {\r\n    return weAtob(output)\r\n  }\r\n}\r\n\r\nexport default function weappJwtDecode(token: string, options?: any) {\r\n  if (typeof token !== 'string') {\r\n    throw 'Invalid token specified'\r\n  }\r\n\r\n  options = options || {}\r\n  const pos = options.header === true ? 0 : 1\r\n  try {\r\n    return JSON.parse(base64_url_decode(token.split('.')[pos]))\r\n  } catch (e: any) {\r\n    throw 'Invalid token specified: ' + e.message\r\n  }\r\n}\r\n\r\nexport function utf8ArrayToStr(array: Uint8Array) {\r\n  let out, i, c\r\n  let char2, char3\r\n\r\n  out = ''\r\n  i = 0\r\n  while (i < array.length) {\r\n    c = array[i++]\r\n    switch (c >> 4) {\r\n      case 0:\r\n      case 1:\r\n      case 2:\r\n      case 3:\r\n      case 4:\r\n      case 5:\r\n      case 6:\r\n      case 7:\r\n        // 0xxxxxxx\r\n        out += String.fromCharCode(c)\r\n        break\r\n      case 12:\r\n      case 13:\r\n        // 110x xxxx   10xx xxxx\r\n        char2 = array[i++]\r\n        out += String.fromCharCode(((c & 0x1f) << 6) | (char2 & 0x3f))\r\n        break\r\n      case 14:\r\n        // 1110 xxxx  10xx xxxx  10xx xxxx\r\n        char2 = array[i++]\r\n        char3 = array[i++]\r\n        out += String.fromCharCode(((c & 0x0f) << 12) | ((char2 & 0x3f) << 6) | ((char3 & 0x3f) << 0))\r\n        break\r\n    }\r\n  }\r\n\r\n  return out\r\n}\r\n","export function md5(md5str: string) {\r\n  const createMD5String = function (string: string) {\r\n    let x = []\r\n    let k, AA, BB, CC, DD, a, b, c, d\r\n    const S11 = 7,\r\n      S12 = 12,\r\n      S13 = 17,\r\n      S14 = 22\r\n    const S21 = 5,\r\n      S22 = 9,\r\n      S23 = 14,\r\n      S24 = 20\r\n    const S31 = 4,\r\n      S32 = 11,\r\n      S33 = 16,\r\n      S34 = 23\r\n    const S41 = 6,\r\n      S42 = 10,\r\n      S43 = 15,\r\n      S44 = 21\r\n    string = uTF8Encode(string)\r\n    x = convertToWordArray(string)\r\n    a = 0x67452301\r\n    b = 0xefcdab89\r\n    c = 0x98badcfe\r\n    d = 0x10325476\r\n    for (k = 0; k < x.length; k += 16) {\r\n      AA = a\r\n      BB = b\r\n      CC = c\r\n      DD = d\r\n      a = FF(a, b, c, d, x[k + 0], S11, 0xd76aa478)\r\n      d = FF(d, a, b, c, x[k + 1], S12, 0xe8c7b756)\r\n      c = FF(c, d, a, b, x[k + 2], S13, 0x242070db)\r\n      b = FF(b, c, d, a, x[k + 3], S14, 0xc1bdceee)\r\n      a = FF(a, b, c, d, x[k + 4], S11, 0xf57c0faf)\r\n      d = FF(d, a, b, c, x[k + 5], S12, 0x4787c62a)\r\n      c = FF(c, d, a, b, x[k + 6], S13, 0xa8304613)\r\n      b = FF(b, c, d, a, x[k + 7], S14, 0xfd469501)\r\n      a = FF(a, b, c, d, x[k + 8], S11, 0x698098d8)\r\n      d = FF(d, a, b, c, x[k + 9], S12, 0x8b44f7af)\r\n      c = FF(c, d, a, b, x[k + 10], S13, 0xffff5bb1)\r\n      b = FF(b, c, d, a, x[k + 11], S14, 0x895cd7be)\r\n      a = FF(a, b, c, d, x[k + 12], S11, 0x6b901122)\r\n      d = FF(d, a, b, c, x[k + 13], S12, 0xfd987193)\r\n      c = FF(c, d, a, b, x[k + 14], S13, 0xa679438e)\r\n      b = FF(b, c, d, a, x[k + 15], S14, 0x49b40821)\r\n      a = GG(a, b, c, d, x[k + 1], S21, 0xf61e2562)\r\n      d = GG(d, a, b, c, x[k + 6], S22, 0xc040b340)\r\n      c = GG(c, d, a, b, x[k + 11], S23, 0x265e5a51)\r\n      b = GG(b, c, d, a, x[k + 0], S24, 0xe9b6c7aa)\r\n      a = GG(a, b, c, d, x[k + 5], S21, 0xd62f105d)\r\n      d = GG(d, a, b, c, x[k + 10], S22, 0x2441453)\r\n      c = GG(c, d, a, b, x[k + 15], S23, 0xd8a1e681)\r\n      b = GG(b, c, d, a, x[k + 4], S24, 0xe7d3fbc8)\r\n      a = GG(a, b, c, d, x[k + 9], S21, 0x21e1cde6)\r\n      d = GG(d, a, b, c, x[k + 14], S22, 0xc33707d6)\r\n      c = GG(c, d, a, b, x[k + 3], S23, 0xf4d50d87)\r\n      b = GG(b, c, d, a, x[k + 8], S24, 0x455a14ed)\r\n      a = GG(a, b, c, d, x[k + 13], S21, 0xa9e3e905)\r\n      d = GG(d, a, b, c, x[k + 2], S22, 0xfcefa3f8)\r\n      c = GG(c, d, a, b, x[k + 7], S23, 0x676f02d9)\r\n      b = GG(b, c, d, a, x[k + 12], S24, 0x8d2a4c8a)\r\n      a = HH(a, b, c, d, x[k + 5], S31, 0xfffa3942)\r\n      d = HH(d, a, b, c, x[k + 8], S32, 0x8771f681)\r\n      c = HH(c, d, a, b, x[k + 11], S33, 0x6d9d6122)\r\n      b = HH(b, c, d, a, x[k + 14], S34, 0xfde5380c)\r\n      a = HH(a, b, c, d, x[k + 1], S31, 0xa4beea44)\r\n      d = HH(d, a, b, c, x[k + 4], S32, 0x4bdecfa9)\r\n      c = HH(c, d, a, b, x[k + 7], S33, 0xf6bb4b60)\r\n      b = HH(b, c, d, a, x[k + 10], S34, 0xbebfbc70)\r\n      a = HH(a, b, c, d, x[k + 13], S31, 0x289b7ec6)\r\n      d = HH(d, a, b, c, x[k + 0], S32, 0xeaa127fa)\r\n      c = HH(c, d, a, b, x[k + 3], S33, 0xd4ef3085)\r\n      b = HH(b, c, d, a, x[k + 6], S34, 0x4881d05)\r\n      a = HH(a, b, c, d, x[k + 9], S31, 0xd9d4d039)\r\n      d = HH(d, a, b, c, x[k + 12], S32, 0xe6db99e5)\r\n      c = HH(c, d, a, b, x[k + 15], S33, 0x1fa27cf8)\r\n      b = HH(b, c, d, a, x[k + 2], S34, 0xc4ac5665)\r\n      a = II(a, b, c, d, x[k + 0], S41, 0xf4292244)\r\n      d = II(d, a, b, c, x[k + 7], S42, 0x432aff97)\r\n      c = II(c, d, a, b, x[k + 14], S43, 0xab9423a7)\r\n      b = II(b, c, d, a, x[k + 5], S44, 0xfc93a039)\r\n      a = II(a, b, c, d, x[k + 12], S41, 0x655b59c3)\r\n      d = II(d, a, b, c, x[k + 3], S42, 0x8f0ccc92)\r\n      c = II(c, d, a, b, x[k + 10], S43, 0xffeff47d)\r\n      b = II(b, c, d, a, x[k + 1], S44, 0x85845dd1)\r\n      a = II(a, b, c, d, x[k + 8], S41, 0x6fa87e4f)\r\n      d = II(d, a, b, c, x[k + 15], S42, 0xfe2ce6e0)\r\n      c = II(c, d, a, b, x[k + 6], S43, 0xa3014314)\r\n      b = II(b, c, d, a, x[k + 13], S44, 0x4e0811a1)\r\n      a = II(a, b, c, d, x[k + 4], S41, 0xf7537e82)\r\n      d = II(d, a, b, c, x[k + 11], S42, 0xbd3af235)\r\n      c = II(c, d, a, b, x[k + 2], S43, 0x2ad7d2bb)\r\n      b = II(b, c, d, a, x[k + 9], S44, 0xeb86d391)\r\n      a = addUnsigned(a, AA)\r\n      b = addUnsigned(b, BB)\r\n      c = addUnsigned(c, CC)\r\n      d = addUnsigned(d, DD)\r\n    }\r\n    const tempValue = wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d)\r\n    return tempValue.toLowerCase()\r\n  }\r\n  const rotateLeft = function (lValue: number, iShiftBits: number) {\r\n    return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits))\r\n  }\r\n  const addUnsigned = function (lX: number, lY: number) {\r\n    const lX8 = lX & 0x80000000\r\n    const lY8 = lY & 0x80000000\r\n    const lX4 = lX & 0x40000000\r\n    const lY4 = lY & 0x40000000\r\n    const lResult = (lX & 0x3fffffff) + (lY & 0x3fffffff)\r\n    if (lX4 & lY4) return lResult ^ 0x80000000 ^ lX8 ^ lY8\r\n    if (lX4 | lY4) {\r\n      if (lResult & 0x40000000) return lResult ^ 0xc0000000 ^ lX8 ^ lY8\r\n      else return lResult ^ 0x40000000 ^ lX8 ^ lY8\r\n    } else {\r\n      return lResult ^ lX8 ^ lY8\r\n    }\r\n  }\r\n  const F = function (x: number, y: number, z: number) {\r\n    return (x & y) | (~x & z)\r\n  }\r\n  const G = function (x: number, y: number, z: number) {\r\n    return (x & z) | (y & ~z)\r\n  }\r\n  const H = function (x: number, y: number, z: number) {\r\n    return x ^ y ^ z\r\n  }\r\n  const I = function (x: number, y: number, z: number) {\r\n    return y ^ (x | ~z)\r\n  }\r\n  const FF = function (a: number, b: number, c: number, d: number, x: number, s: number, ac: number) {\r\n    a = addUnsigned(a, addUnsigned(addUnsigned(F(b, c, d), x), ac))\r\n    return addUnsigned(rotateLeft(a, s), b)\r\n  }\r\n  const GG = function (a: number, b: number, c: number, d: number, x: number, s: number, ac: number) {\r\n    a = addUnsigned(a, addUnsigned(addUnsigned(G(b, c, d), x), ac))\r\n    return addUnsigned(rotateLeft(a, s), b)\r\n  }\r\n  const HH = function (a: number, b: number, c: number, d: number, x: number, s: number, ac: number) {\r\n    a = addUnsigned(a, addUnsigned(addUnsigned(H(b, c, d), x), ac))\r\n    return addUnsigned(rotateLeft(a, s), b)\r\n  }\r\n  const II = function (a: number, b: number, c: number, d: number, x: number, s: number, ac: number) {\r\n    a = addUnsigned(a, addUnsigned(addUnsigned(I(b, c, d), x), ac))\r\n    return addUnsigned(rotateLeft(a, s), b)\r\n  }\r\n  const convertToWordArray = function (string: string) {\r\n    let lWordCount\r\n    const lMessageLength = string.length\r\n    const lNumberOfWordsTempOne = lMessageLength + 8\r\n    const lNumberOfWordsTempTwo = (lNumberOfWordsTempOne - (lNumberOfWordsTempOne % 64)) / 64\r\n    const lNumberOfWords = (lNumberOfWordsTempTwo + 1) * 16\r\n    const lWordArray = Array(lNumberOfWords - 1)\r\n    let lBytePosition = 0\r\n    let lByteCount = 0\r\n    while (lByteCount < lMessageLength) {\r\n      lWordCount = (lByteCount - (lByteCount % 4)) / 4\r\n      lBytePosition = (lByteCount % 4) * 8\r\n      lWordArray[lWordCount] = lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition)\r\n      lByteCount++\r\n    }\r\n    lWordCount = (lByteCount - (lByteCount % 4)) / 4\r\n    lBytePosition = (lByteCount % 4) * 8\r\n    lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition)\r\n    lWordArray[lNumberOfWords - 2] = lMessageLength << 3\r\n    lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29\r\n    return lWordArray\r\n  }\r\n  const wordToHex = function (lValue: number) {\r\n    let WordToHexValue = '',\r\n      WordToHexValueTemp = '',\r\n      lByte,\r\n      lCount\r\n    for (lCount = 0; lCount <= 3; lCount++) {\r\n      lByte = (lValue >>> (lCount * 8)) & 255\r\n      WordToHexValueTemp = '0' + lByte.toString(16)\r\n      WordToHexValue = WordToHexValue + WordToHexValueTemp.substr(WordToHexValueTemp.length - 2, 2)\r\n    }\r\n    return WordToHexValue\r\n  }\r\n  const uTF8Encode = function (string: string) {\r\n    string = string.toString().replace(/\\x0d\\x0a/g, '\\x0a')\r\n    let output = ''\r\n    for (let n = 0; n < string.length; n++) {\r\n      const c = string.charCodeAt(n)\r\n      if (c < 128) {\r\n        output += String.fromCharCode(c)\r\n      } else if (c > 127 && c < 2048) {\r\n        output += String.fromCharCode((c >> 6) | 192)\r\n        output += String.fromCharCode((c & 63) | 128)\r\n      } else {\r\n        output += String.fromCharCode((c >> 12) | 224)\r\n        output += String.fromCharCode(((c >> 6) & 63) | 128)\r\n        output += String.fromCharCode((c & 63) | 128)\r\n      }\r\n    }\r\n    return output\r\n  }\r\n  return createMD5String(md5str)\r\n}\r\n","class FileUtils {\r\n  get fs() {\r\n    return wx.getFileSystemManager()\r\n  }\r\n\r\n  access(path: string): Promise<any> {\r\n    const fs = this.fs\r\n    return new Promise(resolve => {\r\n      fs.access({\r\n        path,\r\n        success() {\r\n          resolve(path)\r\n        },\r\n        fail() {\r\n          resolve(undefined)\r\n        },\r\n      })\r\n    })\r\n  }\r\n\r\n  readFileInBinary(src: string) {\r\n    return new Promise((resolve, reject) => {\r\n      this.fs.readFile({filePath: src, success: resolve, fail: reject, encoding: 'binary'})\r\n    })\r\n  }\r\n\r\n  readFile(filePath: string) {\r\n    const fs = this.fs\r\n    return new Promise((resolve, reject) => {\r\n      fs.readFile({\r\n        filePath,\r\n        encoding: 'utf8',\r\n        position: 0,\r\n        success(res) {\r\n          resolve(res.data)\r\n        },\r\n        fail(res) {\r\n          reject(res)\r\n        },\r\n      })\r\n    })\r\n  }\r\n\r\n  touchDirectory(path: string) {\r\n    const fs = this.fs\r\n    try {\r\n      fs.accessSync(path)\r\n    } catch (e) {\r\n      try {\r\n        fs.mkdirSync(path)\r\n      } catch (err) {\r\n        console.error(e)\r\n      }\r\n    }\r\n  }\r\n  writeFile(filePath: string, data: string | ArrayBuffer) {\r\n    const fs = this.fs\r\n    new Promise((resovle, reject) => {\r\n      fs.writeFile({\r\n        filePath,\r\n        data,\r\n        encoding: 'utf8',\r\n        success: resovle,\r\n        fail: reject,\r\n      })\r\n    })\r\n  }\r\n  writeFileSync(path: string, data: string | ArrayBuffer) {\r\n    const fs = this.fs\r\n    try {\r\n      fs.writeFileSync(path, data, 'utf8')\r\n    } catch (e: any) {\r\n      throw new Error(e)\r\n    }\r\n  }\r\n  removeFile(path: string) {\r\n    console.log('removeFile, path:', path)\r\n    const fs = this.fs\r\n    try {\r\n      fs.accessSync(path)\r\n      fs.unlinkSync(path)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }\r\n  clearDirectory(path: string) {\r\n    const fs = this.fs\r\n    try {\r\n      const res = fs.readdirSync(path)\r\n      if (res.length > 0) {\r\n        res.forEach(file => {\r\n          fs.unlinkSync(`${path}${file}`)\r\n        })\r\n      }\r\n      return true\r\n    } catch (e) {\r\n      console.error(e)\r\n      return false\r\n    }\r\n  }\r\n  checkFileExist(path: string) {\r\n    return new Promise(resolve => {\r\n      wx.getFileInfo({\r\n        filePath: path,\r\n        success() {\r\n          resolve(true)\r\n        },\r\n        fail() {\r\n          resolve(false)\r\n        },\r\n      })\r\n    })\r\n  }\r\n}\r\nexport default new FileUtils()\r\n\r\n/* let instance: FileUtils\r\nexport function fileUtils() {\r\n  if (!instance) {\r\n    instance = new FileUtils()\r\n  }\r\n\r\n  return instance\r\n}\r\n */\r\n","import fileUtils from 'src/utils/fileUtils'\r\n\r\nconst KMaxCacheFileCount = 10\r\n\r\nclass CacheManager {\r\n  private _fs: WechatMiniprogram.FileSystemManager\r\n  private _fileCacheInfos: Array<any> = []\r\n  private avalible = true\r\n\r\n  constructor() {\r\n    this._checkAvalible()\r\n    this._fs = wx.getFileSystemManager()\r\n    this._getStorageInfo()\r\n  }\r\n\r\n  private _checkAvalible() {\r\n    if (wx.setStorage === undefined || \r\n      wx.getStorageInfo === undefined || \r\n      wx.batchGetStorage === undefined) {\r\n        this.avalible = false\r\n      } else {\r\n        this.avalible = true\r\n      }\r\n\r\n      console.log('[CacheManager] _checkAvalible, avalible=', this.avalible)\r\n      return this.avalible\r\n  }\r\n\r\n  saveIndex(url: string, filePath: string) {\r\n    if (!this.avalible) {\r\n      console.log('[CacheManager] saveIndex not avalible')\r\n      return\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      console.debug('[saveIndex] setStorage filePath=', filePath, ', url=', url)\r\n      const key = filePath\r\n      const value = {url, filePath, time: new Date().getTime()}\r\n      // const strValue = JSON.stringify(value)\r\n      let found = false\r\n      for (let i = 0; i < this._fileCacheInfos.length; ++i) {\r\n        const item_i = this._fileCacheInfos[i]\r\n        if (item_i.filePath === filePath) {\r\n          found = true\r\n          break\r\n        }\r\n      }\r\n      if (!found) {\r\n        this._fileCacheInfos.push(value)\r\n      }\r\n      this._checkCache()\r\n      //\r\n      wx.setStorage({\r\n        key,\r\n        data: value,\r\n        success: resolve,\r\n        fail: reject,\r\n        // success(res) {\r\n        //   console.debug('setStorage res=', res, 'key=', key, ', value=', value)\r\n        // },\r\n        // complete(res) {\r\n        //   console.debug('setStorage complete res=', res, 'key=', key, ', value=', value)\r\n        // },\r\n      })\r\n    })\r\n  }\r\n\r\n  private _checkCache() {\r\n    this._fileCacheInfos.sort(function (a, b) {\r\n      return a.time - b.time\r\n    })\r\n    console.debug('_checkCache: this._fileCacheInfos=', this._fileCacheInfos)\r\n\r\n    if (this._fileCacheInfos.length > KMaxCacheFileCount) {\r\n      const deleteCount = this._fileCacheInfos.length - KMaxCacheFileCount\r\n      for (let i = 0; i < deleteCount; ++i) {\r\n        const item_i = this._fileCacheInfos[i]\r\n        if (item_i.filePath) {\r\n          fileUtils.removeFile(item_i.filePath)\r\n          wx.removeStorage({key: item_i.filePath})\r\n        } else {\r\n          console.debug('_checkCache item_i.filePath is undefined, item_i=', item_i)\r\n        }\r\n      }\r\n      this._fileCacheInfos.splice(0, deleteCount)\r\n      console.debug('_checkCache...after, count=', this._fileCacheInfos.length, ', deleteCount=', deleteCount)\r\n    }\r\n  }\r\n\r\n  private _getStorageInfo() {\r\n    if (!this.avalible) {\r\n      console.log('[CacheManager] _getStorageInfo not avalible')\r\n      return\r\n    }\r\n\r\n    wx.getStorageInfo({\r\n      success: res => {\r\n        console.debug('getSorageInfo:keys', res.keys, res.currentSize, res.limitSize)\r\n        if (res && res.keys && res.keys.length > 0) {\r\n          wx.batchGetStorage({\r\n            keyList: res.keys,\r\n            success: (infos: any) => {\r\n              if (infos && infos.dataList) {\r\n                // console.debug('_batchGetStorage: res=', infos.dataList)\r\n                for (const item of infos.dataList) {\r\n                  this._fileCacheInfos.push(item)\r\n                }\r\n                this._checkCache()\r\n                // item: data: \"{\"url\":\"https://yyeva.yy.com/yy/music.mp4\",\"time\":1667274200826}\"\r\n              }\r\n            },\r\n          })\r\n        }\r\n      },\r\n    })\r\n  }\r\n}\r\nexport default new CacheManager()\r\n\r\n/* let instance: CacheManager\r\nexport function cacheManager() {\r\n  if (!instance) {\r\n    instance = new CacheManager()\r\n  }\r\n\r\n  return instance\r\n} */\r\n\r\n// export default CacheManager\r\n","import {inflate} from './zlib/zlib'\r\nimport {PlayerOptionsType, VideoAnimateType} from '../player/types'\r\nimport {utf8ArrayToStr, weAtob} from './jwt'\r\nimport {md5} from '../utils/md5'\r\nimport cacheManager from './cacheManager'\r\nimport fileUtils from 'src/utils/fileUtils'\r\n\r\nconst yyExp = new RegExp('yyeffectmp4json\\\\[\\\\[(.*?)\\\\]\\\\]yyeffectmp4json')\r\nclass Parser {\r\n  fs: WechatMiniprogram.FileSystemManager\r\n  filePath: string\r\n  op!: PlayerOptionsType\r\n  constructor() {\r\n    this.fs = wx.getFileSystemManager()\r\n    this.filePath = `${wx.env.USER_DATA_PATH}/yyeva`\r\n    fileUtils.touchDirectory(this.filePath)\r\n  }\r\n  setup(op: PlayerOptionsType) {\r\n    this.op = op\r\n  }\r\n  async downloadVideo(url: string) {\r\n    let filePath\r\n    let rs\r\n    const fileName = this.getFilenameByUrl(url)\r\n    console.debug('[downloadVideo] fileName=', fileName, ', url=', url, 'useVideoDBCache=', this.op.useVideoDBCache)\r\n    if (!fileName) return undefined\r\n    filePath = this.getFilePath(fileName)\r\n    //\r\n    if (this.op.useVideoDBCache) {\r\n      rs = await fileUtils.access(filePath)\r\n    }\r\n\r\n    let succ = false\r\n    if (!rs) {\r\n      const file: any = await this.downloadFile(url, filePath)\r\n      console.debug(`[downloadVideo in http] file=`, file)\r\n      if (file) {\r\n        filePath = file.filePath\r\n        succ = true\r\n      }\r\n    } else {\r\n      succ = true\r\n      console.debug(`[downloadVideo in cache]`, url, filePath)\r\n    }\r\n\r\n    if (succ && this.op.useVideoDBCache) {\r\n      cacheManager.saveIndex(url, filePath)\r\n    }\r\n    return filePath\r\n  }\r\n  async getMetaData(filePath: string): Promise<VideoAnimateType | undefined> {\r\n    // const jsonFilePath = filePath.toLowerCase().replace('.mp4', '.json')\r\n    const jsonFilePath = `${filePath}.json`\r\n    console.debug('jsonFilePath', jsonFilePath)\r\n    let d: any\r\n    let hasJsonPath = false\r\n    if (this.op.useVideoDBCache) {\r\n      hasJsonPath = await fileUtils.access(jsonFilePath)\r\n    }\r\n    console.debug('hasJsonPath', hasJsonPath)\r\n    if (hasJsonPath && this.op.useVideoDBCache) {\r\n      d = await fileUtils.readFile(jsonFilePath)\r\n      console.debug('[metadata in cache]', jsonFilePath)\r\n    } else {\r\n      const {data}: any = await fileUtils.readFileInBinary(filePath)\r\n      if (!data) return\r\n      const mc = data.match(yyExp)\r\n      if (!mc) return undefined\r\n      const zlibBase64String = mc[1]\r\n      const u8 = inflate(new Uint8Array(this.base64ToArrayBuffer(zlibBase64String)))\r\n      d = utf8ArrayToStr(u8)\r\n      if (d && this.op.useVideoDBCache) {\r\n        console.log('jsonFilePath writeFile', jsonFilePath)\r\n        await fileUtils.writeFile(jsonFilePath, d)\r\n      }\r\n    }\r\n    d = JSON.parse(d)\r\n    return d\r\n  }\r\n\r\n  downloadFile(url: string, filePath?: string) {\r\n    return new Promise((resolve, reject) => {\r\n      wx.downloadFile({\r\n        filePath,\r\n        url,\r\n        success: resolve,\r\n        fail: reject,\r\n      })\r\n    })\r\n  }\r\n  getFilePath(fileName: string) {\r\n    return `${this.filePath}/${fileName}`\r\n  }\r\n  getFilenameByUrl(url: string) {\r\n    const name = url.split('/').pop()\r\n    return md5(url) + '_' + name\r\n  }\r\n  base64ToArrayBuffer(base64: string) {\r\n    const binary_string = weAtob(base64)\r\n    const len = binary_string.length\r\n    const bytes = new Uint8Array(len)\r\n    for (let i = 0; i < len; i++) {\r\n      bytes[i] = binary_string.charCodeAt(i)\r\n    }\r\n    return bytes.buffer\r\n  }\r\n}\r\nexport default new Parser()\r\n","import {EventCallback, PlayerOptionsType, VideoAnimateType} from './types'\r\nimport VideoPlayer from './video'\r\nimport WebGL from './webgl'\r\nimport parser from '../parser/index'\r\n// import {createRenderer} from './render'\r\n\r\nexport class Player {\r\n  container!: any\r\n  op!: PlayerOptionsType\r\n  video!: VideoPlayer\r\n  metadatas?: VideoAnimateType //描述文件\r\n  filePath!: string\r\n  webgl: WebGL\r\n  currentFrame: number\r\n  isShow: boolean\r\n  // public onEnd: EventCallback\r\n  private onDestroy?: EventCallback\r\n  constructor() {\r\n    this.webgl = new WebGL()\r\n    this.currentFrame = -1\r\n    this.isShow = true\r\n  }\r\n  async setup(op: PlayerOptionsType) {\r\n    this.op = op\r\n    if (this.op.onDestory) this.onDestroy = this.op.onDestory\r\n    // let render: any\r\n    parser.setup(op)\r\n    await this.parserVideo()\r\n    console.debug('[webgl] setup start')\r\n    await this.webgl.setup(op, this.metadatas)\r\n    console.debug('[VideoPlayer] new')\r\n    this.video = new VideoPlayer(op, this.filePath)\r\n    this.video.onInit = v => {\r\n      console.debug('[video onInit]', v)\r\n      this.webgl.setOnVideoInit(v)\r\n      // render = createRenderer(this.op.canvas, v.width, v.height)\r\n    }\r\n    this.video.onUpdate = (frame, v) => {\r\n      if (this.currentFrame === frame) return\r\n      if (!v.data || !this.isShow) {\r\n        // console.log('_setPlayerIsShow', this.isShow)\r\n        return\r\n      }\r\n\r\n      this.webgl.render(frame, v)\r\n      // render(frame, v)\r\n      this.currentFrame = frame\r\n    }\r\n    this.video.onEnd = () => {\r\n      console.debug('video onEnd')\r\n      this.destroy()\r\n      this.currentFrame = -1\r\n    }\r\n  }\r\n  async parserVideo() {\r\n    const vd: any = await parser.downloadVideo(this.op.videoUrl)\r\n    // console.debug('[player] downloadVideo', vd)\r\n    if (vd) {\r\n      this.filePath = vd\r\n      this.metadatas = await parser.getMetaData(vd)\r\n      console.debug('[player] getMetaData done!')\r\n    }\r\n    return this.metadatas\r\n  }\r\n  start() {\r\n    this.video.start()\r\n  }\r\n  stop() {\r\n    this.video.stop()\r\n  }\r\n  destroy() {\r\n    // console.log('[player destroy]')\r\n    if (this.video.isStart) {\r\n      this.stop()\r\n    }\r\n    this.video.destroy()\r\n    this.webgl.destroy()\r\n\r\n    this.metadatas = undefined\r\n    this.filePath = undefined\r\n    this.currentFrame = -1\r\n    this.webgl = undefined\r\n    this.video = undefined\r\n    this.op = undefined\r\n    this.onDestroy && this.onDestroy()\r\n  }\r\n}\r\n//\r\nexport default async function yyEva(op: PlayerOptionsType) {\r\n  //\r\n  const player = new Player()\r\n  const defaultOptions: any = {\r\n    loop: false,\r\n    alphaDirection: 'right',\r\n    mute: false,\r\n    useVideoDBCache: true,\r\n    // mode: 'AspectFill',\r\n    mode: 'contain',\r\n    font: {\r\n      overflow: 'cut',\r\n    },\r\n  }\r\n  op = {...defaultOptions, ...op}\r\n  //\r\n  // if (op.showVideo) {\r\n  // console.log('[getPerformance]')\r\n  // const performance = wx.getPerformance()\r\n  // const observer = performance.createObserver(entryList => {\r\n  //   console.log(entryList.getEntries())\r\n  // })\r\n  // observer.observe({entryTypes: ['render', 'script', 'navigation']})\r\n  // }\r\n  //\r\n  await player.setup(op)\r\n  return player\r\n}\r\nexport type YYEvaType = Player\r\nexport {PlayerOptionsType}\r\n","export default {\r\n  version: process.env.version,\r\n  env: process.env.env,\r\n}\r\n","import yyEva, {PlayerOptionsType, YYEvaType} from './player/index'\r\nimport config from './config'\r\nimport {md5} from './utils/md5'\r\n\r\nconst players: {[key: string]: YYEvaType} = {}\r\n//\r\nconsole.debug(`[yyeva wechat ${config.env}] v${config.version}`)\r\n\r\n//\r\nComponent({\r\n  properties: {\r\n    options: {\r\n      type: Object,\r\n      value: {},\r\n    },\r\n  },\r\n  data: {\r\n    canvasId: ``,\r\n    canvas2dId: ``,\r\n    isLoad: false,\r\n  },\r\n  methods: {\r\n    onEnd(e: any) {\r\n      this.triggerEvent('onEnd', e)\r\n    },\r\n    onStart(e: any) {\r\n      this.triggerEvent('onStart', e)\r\n    },\r\n    onStop(e: any) {\r\n      this.triggerEvent('onStop', e)\r\n    },\r\n    async _startToPlay() {\r\n      if (!this.data.options.videoUrl || !this.data.isLoad) return\r\n      // console.log('[_startToPlay players]', players)\r\n      //\r\n      const videoUrl = this.data.options.videoUrl\r\n      const eTag = md5(videoUrl)\r\n      const canvasId = `yyeva-webgl-${eTag}`\r\n      this.setData({canvasId})\r\n      // console.log('canvasId', canvasId)\r\n      const [yyEvaCanvas, yyEvaCanvasClient] = await Promise.all([\r\n        this._getNode(canvasId),\r\n        this._getClientRect(canvasId),\r\n      ])\r\n      // show video\r\n      let canvas2d: any\r\n      let ctx2d: any\r\n      if (this.data.options.showVideo) {\r\n        const canvas2dId = `yyeva-canvas2d-${eTag}`\r\n        this.setData({canvas2dId})\r\n        //\r\n        canvas2d = await this._getNode(canvas2dId)\r\n        ctx2d = canvas2d.getContext('2d')\r\n      }\r\n      //\r\n      const op: PlayerOptionsType = {\r\n        canvas: yyEvaCanvas,\r\n        canvasClient: yyEvaCanvasClient,\r\n        canvas2d,\r\n        ctx2d,\r\n        onEnd: e => this.onEnd(e),\r\n        onStop: e => this.onStop(e),\r\n        onStart: e => this.onStart(e),\r\n        onDestory: () => {\r\n          // console.log('onDestory', videoUrl)\r\n          delete players[videoUrl]\r\n        },\r\n        ...(this.data.options as any),\r\n      }\r\n      // console.log('_startToPlay', op)\r\n      // const player = await yyEva(op)\r\n      // player.start()\r\n      players[videoUrl] = await yyEva(op)\r\n      players[videoUrl].start()\r\n    },\r\n\r\n    _getNode(id: string): Promise<any> {\r\n      const query = this.createSelectorQuery()\r\n      id = `#${id}`\r\n      return new Promise(resolve => {\r\n        query\r\n          .select(id)\r\n          .node(res => resolve(res.node))\r\n          .exec()\r\n      })\r\n    },\r\n    _getClientRect(id: string): Promise<any> {\r\n      const query = this.createSelectorQuery()\r\n      id = `#${id}`\r\n      return new Promise(resolve => {\r\n        query.select(id).boundingClientRect(resolve).exec()\r\n      })\r\n    },\r\n    _setPlayerIsShow(isShow: boolean) {\r\n      const videoUrl = this.data.options.videoUrl\r\n      if (players[videoUrl]) {\r\n        players[videoUrl].isShow = isShow\r\n      }\r\n    },\r\n  },\r\n  // options: {\r\n  //   addGlobalClass: true,\r\n  // },\r\n  observers: {\r\n    'options.**': function (options) {\r\n      // console.log('[observers]', options)\r\n      this._startToPlay()\r\n    },\r\n  },\r\n  lifetimes: {\r\n    created() {\r\n      //在组件实例刚刚被创建时执行\r\n    },\r\n    attached() {\r\n      //\t在组件实例进入页面节点树时执行\r\n    },\r\n    async ready() {\r\n      this.setData({isLoad: true})\r\n      //在组件在视图层布局完成后执行\r\n\r\n      this._startToPlay()\r\n    },\r\n    moved() {\r\n      // 在组件实例被移动到节点树另一个位置时执行\r\n    },\r\n    detached() {\r\n      //在组件实例被从页面节点树移除时执行\r\n\r\n      const videoUrl = this.data.options.videoUrl\r\n      if (videoUrl && players[videoUrl]) {\r\n        if (players[videoUrl].destroy) players[videoUrl].destroy()\r\n        delete players[videoUrl]\r\n      }\r\n      this.setData({isLoad: false})\r\n      // console.log('[detached players]', players)\r\n    },\r\n    error(e) {\r\n      //每当组件方法抛出错误时执行\r\n      console.error('[lifetimes error]', e)\r\n    },\r\n  },\r\n  pageLifetimes: {\r\n    show() {\r\n      // 页面被展示\r\n      // console.log('[pageLifetimes show]')\r\n      this._setPlayerIsShow(true)\r\n    },\r\n    hide() {\r\n      // 页面被隐藏\r\n      // console.log('[pageLifetimes hide]')\r\n      this._setPlayerIsShow(false)\r\n    },\r\n    resize(size) {\r\n      // 页面尺寸变化\r\n      // console.log('[pageLifetimes resize]', size)\r\n    },\r\n  },\r\n})\r\n"],"mappings":"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","names":["Animator","op","fps","t","mediaTime","fn","now","delta","animator_default","LoopChecker","loop","onLoop","type","NaPlayer","op","filePath","pos","o","e","res","d","f","imageData","VideoPlayer","op","filePath","animator_default","LoopChecker","NaPlayer","d","e","f","pos","video_default","systemInfo","dpr","pixelRatio","platform","EffectKey","op","effect","effects","item","effectType","effectTag","ctx","text","maxWidth","_a","_b","_c","_d","textWidth","len","fontStyle","fontColor","fontSize","w","h","txt","getFontStyle","font","url","img","drawWidth","drawHeight","sx","sy","adapt","resovle","reject","image","e","PER_SIZE","WebGL","op","metadatas","EffectKey","o","gl","effect","v","descript","cv","dpr","x","y","h","platform","fs","vs","vertexShader","fragmentShader","program","aVertexPosition","vertexTexCoordAttribute","aAlphaTexCoord","view","size","scaleLocation","scaleSize","frame","datas","item","posArr","vW","vH","frameData","frameItem","rgbX","rgbY","w","mX","mY","mW","mH","coord","mCoord","imgPostLocation","textureMap","i","k","r","sampler","dumpTexture","uImageVideoLocation","index","img","textrueIndex","mode","scaleX","scaleY","clientWidth","clientHeight","vw","vh","canvasAspect","videoAspect","ver","rgbW","rgbH","aX","aY","aW","aH","rgbCoord","aCoord","alphaDirection","d","stageW","src","type","shader","textureSize","sourceTexure","sourceUniform","imgColor","samplers","BTYPE","LENGTH_EXTRA_BIT_LEN","LENGTH_EXTRA_BIT_BASE","DISTANCE_EXTRA_BIT_BASE","DISTANCE_EXTRA_BIT_LEN","CODELEN_VALUES","generateHuffmanTable","codelenValues","codelens","codelen","codelenMax","codelenMin","key","code","values","bitlenTables","bitlen","a","table","value","makeFixedHuffmanCodelenValues","i","BitReadStream","buffer","offset","bit","length","bits","i","Uint8WriteStream","extendedSize","value","newBuffer","nowSize","FIXED_HUFFMAN_TABLE","generateHuffmanTable","makeFixedHuffmanCodelenValues","inflate","input","offset","buffer","Uint8WriteStream","stream","BitReadStream","bFinal","bType","BTYPE","inflateUncompressedBlock","inflateFixedBlock","inflateDynamicBlock","LEN","NLEN","tables","codelens","codelen","codelenMax","codelenMin","key","code","value","repeatLengthCode","repeatLengthValue","repeatLengthExt","repeatDistanceCode","repeatDistanceValue","repeatDistanceExt","repeatStartIndex","LENGTH_EXTRA_BIT_BASE","LENGTH_EXTRA_BIT_LEN","DISTANCE_EXTRA_BIT_BASE","DISTANCE_EXTRA_BIT_LEN","i","HLIT","HDIST","HCLEN","codelenCodelen","codelenCodelenValues","CODELEN_VALUES","codelenHuffmanTables","codelenCodelens","codelenCodelenMax","codelenCodelenMin","dataCodelenValues","distanceCodelenValues","codelenCode","runlengthCode","repeat","codesNumber","dataHuffmanTables","distanceHuffmanTables","dataCodelens","dataCodelen","dataCodelenMax","dataCodelenMin","distanceCodelens","distanceCodelen","distanceCodelenMax","distanceCodelenMin","dataCode","data","repeatDistanceCodeCodelen","repeatDistanceCodeCode","inflate","input","stream","BitReadStream","CINFO","FCHECK","FDICT","FLEVEL","b64","b64re","weAtob","string","b64re","bitmap","result","r1","r2","i","b64","utf8ArrayToStr","array","out","i","c","char2","char3","md5","md5str","createMD5String","string","x","k","AA","BB","CC","DD","a","b","c","d","uTF8Encode","convertToWordArray","FF","GG","HH","II","addUnsigned","wordToHex","rotateLeft","lValue","iShiftBits","lX","lY","lX8","lY8","lX4","lY4","lResult","F","y","z","G","H","I","s","ac","lWordCount","lMessageLength","lNumberOfWordsTempOne","lNumberOfWords","lWordArray","lBytePosition","lByteCount","WordToHexValue","WordToHexValueTemp","lByte","lCount","output","n","FileUtils","path","fs","resolve","src","reject","filePath","res","e","data","resovle","file","fileUtils_default","KMaxCacheFileCount","CacheManager","url","filePath","resolve","reject","key","value","found","i","a","b","deleteCount","item_i","fileUtils_default","res","infos","item","cacheManager_default","yyExp","Parser","fileUtils_default","op","url","filePath","rs","fileName","succ","file","cacheManager_default","jsonFilePath","d","hasJsonPath","data","mc","zlibBase64String","u8","inflate","utf8ArrayToStr","resolve","reject","name","md5","base64","binary_string","weAtob","len","bytes","i","parser_default","Player","WebGL","op","parser_default","video_default","v","frame","vd","yyEva","player","config_default","players","config_default","e","videoUrl","eTag","md5","canvasId","yyEvaCanvas","yyEvaCanvasClient","canvas2d","ctx2d","canvas2dId","op","yyEva","id","query","resolve","res","isShow","options","size"]}